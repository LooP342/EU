<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>mega-menu.js - Documentation</title><script src="scripts/prettify/prettify.js"></script><script src="scripts/prettify/lang-css.js"></script><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><link href="styles/prettify.css" rel="stylesheet" type="text/css"><link href="styles/jsdoc.css" rel="stylesheet" type="text/css"><script src="scripts/nav.js" defer></script><meta content="width=device-width,initial-scale=1" name="viewport"></head><body><input class="nav-trigger" id="nav-trigger" type="checkbox"> <label class="navicon-button x" for="nav-trigger"><div class="navicon"></div></label> <label class="overlay" for="nav-trigger"></label><nav><h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="MegaMenu.html">MegaMenu</a><ul class="methods"><li data-type="method"><a href="MegaMenu.html#checkDropdownHeight">checkDropdownHeight</a></li><li data-type="method"><a href="MegaMenu.html#closeOpenDropdown">closeOpenDropdown</a></li><li data-type="method"><a href="MegaMenu.html#destroy">destroy</a></li><li data-type="method"><a href="MegaMenu.html#disableScroll">disableScroll</a></li><li data-type="method"><a href="MegaMenu.html#enableScroll">enableScroll</a></li><li data-type="method"><a href="MegaMenu.html#handleClickGlobal">handleClickGlobal</a></li><li data-type="method"><a href="MegaMenu.html#handleClickOnBack">handleClickOnBack</a></li><li data-type="method"><a href="MegaMenu.html#handleClickOnClose">handleClickOnClose</a></li><li data-type="method"><a href="MegaMenu.html#handleClickOnItem">handleClickOnItem</a></li><li data-type="method"><a href="MegaMenu.html#handleClickOnOpen">handleClickOnOpen</a></li><li data-type="method"><a href="MegaMenu.html#handleClickOnSubitem">handleClickOnSubitem</a></li><li data-type="method"><a href="MegaMenu.html#handleClickOnToggle">handleClickOnToggle</a></li><li data-type="method"><a href="MegaMenu.html#handleFirstPanel">handleFirstPanel</a></li><li data-type="method"><a href="MegaMenu.html#handleFocusOut">handleFocusOut</a></li><li data-type="method"><a href="MegaMenu.html#handleKeyboard">handleKeyboard</a></li><li data-type="method"><a href="MegaMenu.html#handleKeyboardGlobal">handleKeyboardGlobal</a></li><li data-type="method"><a href="MegaMenu.html#handleResize">handleResize</a></li><li data-type="method"><a href="MegaMenu.html#handleSecondPanel">handleSecondPanel</a></li><li data-type="method"><a href="MegaMenu.html#init">init</a></li><li data-type="method"><a href="MegaMenu.html#on">on</a></li><li data-type="method"><a href="MegaMenu.html#positionMenuOverlay">positionMenuOverlay</a></li><li data-type="method"><a href="MegaMenu.html#resetStyles">resetStyles</a></li><li data-type="method"><a href="MegaMenu.html#trigger">trigger</a></li><li data-type="method"><a href="MegaMenu.html#useDesktopDisplay">useDesktopDisplay</a></li><li data-type="method"><a href="MegaMenu.html#.autoInit">autoInit</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="MegaMenu.html#event:onBack">onBack</a></li><li><a href="MegaMenu.html#event:onClose">onClose</a></li><li><a href="MegaMenu.html#event:onFocusTrapToggle">onFocusTrapToggle</a></li><li><a href="MegaMenu.html#event:onItemClick">onItemClick</a></li><li><a href="MegaMenu.html#event:onOpen">onOpen</a></li><li><a href="MegaMenu.html#event:onOpenPanel">onOpenPanel</a></li></ul></nav><div id="main"><h1 class="page-title">mega-menu.js</h1><section><article><pre class="prettyprint source linenums"><ol class="linenums"><li class="L0" id="line1"><code><span class="com">/* eslint-disable  class-methods-use-this */</span></code></li><li class="L1" id="line2"><code></code></li><li class="L2" id="line3"><code><span class="kwd">import</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> queryOne</span><span class="pun">,</span><span class="pln"> queryAll </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'@ecl/dom-utils'</span><span class="pun">;</span></code></li><li class="L3" id="line4"><code><span class="kwd">import</span><span class="pln"> </span><span class="typ">EventManager</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'@ecl/event-manager'</span><span class="pun">;</span></code></li><li class="L4" id="line5"><code><span class="kwd">import</span><span class="pln"> isMobile </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'mobile-device-detect'</span><span class="pun">;</span></code></li><li class="L5" id="line6"><code><span class="kwd">import</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> createFocusTrap </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'focus-trap'</span><span class="pun">;</span></code></li><li class="L6" id="line7"><code></code></li><li class="L7" id="line8"><code><span class="com">/**</span></code></li><li class="L8" id="line9"><code><span class="com"> * @param {HTMLElement} element DOM element for component instantiation and scope</span></code></li><li class="L9" id="line10"><code><span class="com"> * @param {Object} options</span></code></li><li class="L0" id="line11"><code><span class="com"> * @param {String} options.openSelector Selector for the hamburger button</span></code></li><li class="L1" id="line12"><code><span class="com"> * @param {String} options.backSelector Selector for the back button</span></code></li><li class="L2" id="line13"><code><span class="com"> * @param {String} options.innerSelector Selector for the menu inner</span></code></li><li class="L3" id="line14"><code><span class="com"> * @param {String} options.listSelector Selector for the menu items list</span></code></li><li class="L4" id="line15"><code><span class="com"> * @param {String} options.itemSelector Selector for the menu item</span></code></li><li class="L5" id="line16"><code><span class="com"> * @param {String} options.linkSelector Selector for the menu link</span></code></li><li class="L6" id="line17"><code><span class="com"> * @param {String} options.subLinkSelector Selector for the menu sub link</span></code></li><li class="L7" id="line18"><code><span class="com"> * @param {String} options.megaSelector Selector for the mega menu</span></code></li><li class="L8" id="line19"><code><span class="com"> * @param {String} options.subItemSelector Selector for the menu sub items</span></code></li><li class="L9" id="line20"><code><span class="com"> * @param {String} options.labelOpenAttribute The data attribute for open label</span></code></li><li class="L0" id="line21"><code><span class="com"> * @param {String} options.labelCloseAttribute The data attribute for close label</span></code></li><li class="L1" id="line22"><code><span class="com"> * @param {Boolean} options.attachClickListener Whether or not to bind click events</span></code></li><li class="L2" id="line23"><code><span class="com"> * @param {Boolean} options.attachHoverListener Whether or not to bind hover events</span></code></li><li class="L3" id="line24"><code><span class="com"> * @param {Boolean} options.attachFocusListener Whether or not to bind focus events</span></code></li><li class="L4" id="line25"><code><span class="com"> * @param {Boolean} options.attachKeyListener Whether or not to bind keyboard events</span></code></li><li class="L5" id="line26"><code><span class="com"> * @param {Boolean} options.attachResizeListener Whether or not to bind resize events</span></code></li><li class="L6" id="line27"><code><span class="com"> */</span></code></li><li class="L7" id="line28"><code><span class="kwd">export</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MegaMenu</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line29"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L9" id="line30"><code><span class="com">   * @static</span></code></li><li class="L0" id="line31"><code><span class="com">   * Shorthand for instance creation and initialisation.</span></code></li><li class="L1" id="line32"><code><span class="com">   *</span></code></li><li class="L2" id="line33"><code><span class="com">   * @param {HTMLElement} root DOM element for component instantiation and scope</span></code></li><li class="L3" id="line34"><code><span class="com">   *</span></code></li><li class="L4" id="line35"><code><span class="com">   * @return {Menu} An instance of Menu.</span></code></li><li class="L5" id="line36"><code><span class="com">   */</span></code></li><li class="L6" id="line37"><code><span class="pln">  </span><span class="kwd">static</span><span class="pln"> autoInit</span><span class="pun">(</span><span class="pln">root</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> MEGA_MENU</span><span class="pun">:</span><span class="pln"> defaultOptions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{})</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line38"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> megaMenu </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MegaMenu</span><span class="pun">(</span><span class="pln">root</span><span class="pun">,</span><span class="pln"> defaultOptions</span><span class="pun">);</span></code></li><li class="L8" id="line39"><code><span class="pln">    megaMenu</span><span class="pun">.</span><span class="pln">init</span><span class="pun">();</span></code></li><li class="L9" id="line40"><code><span class="pln">    root</span><span class="pun">.</span><span class="typ">ECLMegaMenu</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> megaMenu</span><span class="pun">;</span></code></li><li class="L0" id="line41"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> megaMenu</span><span class="pun">;</span></code></li><li class="L1" id="line42"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L2" id="line43"><code></code></li><li class="L3" id="line44"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L4" id="line45"><code><span class="com">   *   @event MegaMenu#onOpen</span></code></li><li class="L5" id="line46"><code><span class="com">   */</span></code></li><li class="L6" id="line47"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L7" id="line48"><code><span class="com">   *   @event MegaMenu#onClose</span></code></li><li class="L8" id="line49"><code><span class="com">   */</span></code></li><li class="L9" id="line50"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L0" id="line51"><code><span class="com">   *   @event MegaMenu#onOpenPanel</span></code></li><li class="L1" id="line52"><code><span class="com">   */</span></code></li><li class="L2" id="line53"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L3" id="line54"><code><span class="com">   *   @event MegaMenu#onBack</span></code></li><li class="L4" id="line55"><code><span class="com">   */</span></code></li><li class="L5" id="line56"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L6" id="line57"><code><span class="com">   *   @event MegaMenu#onItemClick</span></code></li><li class="L7" id="line58"><code><span class="com">   */</span></code></li><li class="L8" id="line59"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L9" id="line60"><code><span class="com">   *   @event MegaMenu#onFocusTrapToggle</span></code></li><li class="L0" id="line61"><code><span class="com">   */</span></code></li><li class="L1" id="line62"><code></code></li><li class="L2" id="line63"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L3" id="line64"><code><span class="com">   * An array of supported events for this component.</span></code></li><li class="L4" id="line65"><code><span class="com">   *</span></code></li><li class="L5" id="line66"><code><span class="com">   * @type {Array&lt;string>}</span></code></li><li class="L6" id="line67"><code><span class="com">   * @memberof MegaMenu</span></code></li><li class="L7" id="line68"><code><span class="com">   */</span></code></li><li class="L8" id="line69"><code><span class="pln">  supportedEvents </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'onOpen'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'onClose'</span><span class="pun">];</span></code></li><li class="L9" id="line70"><code></code></li><li class="L0" id="line71"><code><span class="pln">  constructor</span><span class="pun">(</span></code></li><li class="L1" id="line72"><code><span class="pln">    element</span><span class="pun">,</span></code></li><li class="L2" id="line73"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L3" id="line74"><code><span class="pln">      openSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-open]'</span><span class="pun">,</span></code></li><li class="L4" id="line75"><code><span class="pln">      backSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-back]'</span><span class="pun">,</span></code></li><li class="L5" id="line76"><code><span class="pln">      innerSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-inner]'</span><span class="pun">,</span></code></li><li class="L6" id="line77"><code><span class="pln">      listSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-list]'</span><span class="pun">,</span></code></li><li class="L7" id="line78"><code><span class="pln">      itemSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-item]'</span><span class="pun">,</span></code></li><li class="L8" id="line79"><code><span class="pln">      linkSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-link]'</span><span class="pun">,</span></code></li><li class="L9" id="line80"><code><span class="pln">      subLinkSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-sublink]'</span><span class="pun">,</span></code></li><li class="L0" id="line81"><code><span class="pln">      megaSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-mega]'</span><span class="pun">,</span></code></li><li class="L1" id="line82"><code><span class="pln">      containerSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-has-container]'</span><span class="pun">,</span></code></li><li class="L2" id="line83"><code><span class="pln">      subItemSelector </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-subitem]'</span><span class="pun">,</span></code></li><li class="L3" id="line84"><code><span class="pln">      featuredAttribute </span><span class="pun">=</span><span class="pln"> </span><span class="str">'[data-ecl-mega-menu-featured]'</span><span class="pun">,</span></code></li><li class="L4" id="line85"><code><span class="pln">      labelOpenAttribute </span><span class="pun">=</span><span class="pln"> </span><span class="str">'data-ecl-mega-menu-label-open'</span><span class="pun">,</span></code></li><li class="L5" id="line86"><code><span class="pln">      labelCloseAttribute </span><span class="pun">=</span><span class="pln"> </span><span class="str">'data-ecl-mega-menu-label-close'</span><span class="pun">,</span></code></li><li class="L6" id="line87"><code><span class="pln">      attachClickListener </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></code></li><li class="L7" id="line88"><code><span class="pln">      attachFocusListener </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></code></li><li class="L8" id="line89"><code><span class="pln">      attachKeyListener </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></code></li><li class="L9" id="line90"><code><span class="pln">      attachResizeListener </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></code></li><li class="L0" id="line91"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{},</span></code></li><li class="L1" id="line92"><code><span class="pln">  </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line93"><code><span class="pln">    </span><span class="com">// Check element</span></code></li><li class="L3" id="line94"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">element </span><span class="pun">||</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">nodeType </span><span class="pun">!==</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">.</span><span class="pln">ELEMENT_NODE</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line95"><code><span class="pln">      </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TypeError</span><span class="pun">(</span></code></li><li class="L5" id="line96"><code><span class="pln">        </span><span class="str">'DOM element should be given to initialize this widget.'</span><span class="pun">,</span></code></li><li class="L6" id="line97"><code><span class="pln">      </span><span class="pun">);</span></code></li><li class="L7" id="line98"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8" id="line99"><code></code></li><li class="L9" id="line100"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element </span><span class="pun">=</span><span class="pln"> element</span><span class="pun">;</span></code></li><li class="L0" id="line101"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">eventManager </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">EventManager</span><span class="pun">();</span></code></li><li class="L1" id="line102"><code></code></li><li class="L2" id="line103"><code><span class="pln">    </span><span class="com">// Options</span></code></li><li class="L3" id="line104"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openSelector </span><span class="pun">=</span><span class="pln"> openSelector</span><span class="pun">;</span></code></li><li class="L4" id="line105"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backSelector </span><span class="pun">=</span><span class="pln"> backSelector</span><span class="pun">;</span></code></li><li class="L5" id="line106"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">innerSelector </span><span class="pun">=</span><span class="pln"> innerSelector</span><span class="pun">;</span></code></li><li class="L6" id="line107"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">listSelector </span><span class="pun">=</span><span class="pln"> listSelector</span><span class="pun">;</span></code></li><li class="L7" id="line108"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">itemSelector </span><span class="pun">=</span><span class="pln"> itemSelector</span><span class="pun">;</span></code></li><li class="L8" id="line109"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">linkSelector </span><span class="pun">=</span><span class="pln"> linkSelector</span><span class="pun">;</span></code></li><li class="L9" id="line110"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subLinkSelector </span><span class="pun">=</span><span class="pln"> subLinkSelector</span><span class="pun">;</span></code></li><li class="L0" id="line111"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">megaSelector </span><span class="pun">=</span><span class="pln"> megaSelector</span><span class="pun">;</span></code></li><li class="L1" id="line112"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItemSelector </span><span class="pun">=</span><span class="pln"> subItemSelector</span><span class="pun">;</span></code></li><li class="L2" id="line113"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">containerSelector </span><span class="pun">=</span><span class="pln"> containerSelector</span><span class="pun">;</span></code></li><li class="L3" id="line114"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">labelOpenAttribute </span><span class="pun">=</span><span class="pln"> labelOpenAttribute</span><span class="pun">;</span></code></li><li class="L4" id="line115"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">labelCloseAttribute </span><span class="pun">=</span><span class="pln"> labelCloseAttribute</span><span class="pun">;</span></code></li><li class="L5" id="line116"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachClickListener </span><span class="pun">=</span><span class="pln"> attachClickListener</span><span class="pun">;</span></code></li><li class="L6" id="line117"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachFocusListener </span><span class="pun">=</span><span class="pln"> attachFocusListener</span><span class="pun">;</span></code></li><li class="L7" id="line118"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachKeyListener </span><span class="pun">=</span><span class="pln"> attachKeyListener</span><span class="pun">;</span></code></li><li class="L8" id="line119"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachResizeListener </span><span class="pun">=</span><span class="pln"> attachResizeListener</span><span class="pun">;</span></code></li><li class="L9" id="line120"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">featuredAttribute </span><span class="pun">=</span><span class="pln"> featuredAttribute</span><span class="pun">;</span></code></li><li class="L0" id="line121"><code></code></li><li class="L1" id="line122"><code><span class="pln">    </span><span class="com">// Private variables</span></code></li><li class="L2" id="line123"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">direction </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ltr'</span><span class="pun">;</span></code></li><li class="L3" id="line124"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L4" id="line125"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">toggleLabel </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L5" id="line126"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">back </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L6" id="line127"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backItemLevel1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L7" id="line128"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backItemLevel2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L8" id="line129"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">inner </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L9" id="line130"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">itemsList </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L0" id="line131"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L1" id="line132"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">links </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L2" id="line133"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isOpen </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L3" id="line134"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">resizeTimer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L4" id="line135"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isKeyEvent </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L5" id="line136"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L6" id="line137"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isLarge </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L7" id="line138"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">lastVisibleItem </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L8" id="line139"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">currentItem </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L9" id="line140"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">totalItemsWidth </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L0" id="line141"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">breakpointL </span><span class="pun">=</span><span class="pln"> </span><span class="lit">996</span><span class="pun">;</span></code></li><li class="L1" id="line142"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> num</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"> </span><span class="pun">};</span></code></li><li class="L2" id="line143"><code></code></li><li class="L3" id="line144"><code><span class="pln">    </span><span class="com">// Bind `this` for use in callbacks</span></code></li><li class="L4" id="line145"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnOpen </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnOpen</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L5" id="line146"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnClose </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnClose</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L6" id="line147"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnToggle </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnToggle</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L7" id="line148"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnBack </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnBack</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L8" id="line149"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickGlobal </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickGlobal</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L9" id="line150"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnItem </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnItem</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L0" id="line151"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnSubitem </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnSubitem</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L1" id="line152"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFocusOut </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFocusOut</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L2" id="line153"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboard </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboard</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L3" id="line154"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboardGlobal </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboardGlobal</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L4" id="line155"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleResize </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleResize</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L5" id="line156"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">useDesktopDisplay </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">useDesktopDisplay</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L6" id="line157"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">closeOpenDropdown </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">closeOpenDropdown</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L7" id="line158"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">checkDropdownHeight </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">checkDropdownHeight</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L8" id="line159"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">positionMenuOverlay </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">positionMenuOverlay</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L9" id="line160"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">resetStyles </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">resetStyles</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L0" id="line161"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFirstPanel </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFirstPanel</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L1" id="line162"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleSecondPanel </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleSecondPanel</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L2" id="line163"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">disableScroll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">disableScroll</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L3" id="line164"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">enableScroll </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">enableScroll</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L4" id="line165"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L5" id="line166"><code></code></li><li class="L6" id="line167"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L7" id="line168"><code><span class="com">   * Initialise component.</span></code></li><li class="L8" id="line169"><code><span class="com">   */</span></code></li><li class="L9" id="line170"><code><span class="pln">  init</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line171"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">ECL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line172"><code><span class="pln">      </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TypeError</span><span class="pun">(</span><span class="str">'Called init but ECL is not present'</span><span class="pun">);</span></code></li><li class="L2" id="line173"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3" id="line174"><code><span class="pln">    ECL</span><span class="pun">.</span><span class="pln">components </span><span class="pun">=</span><span class="pln"> ECL</span><span class="pun">.</span><span class="pln">components </span><span class="pun">||</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">();</span></code></li><li class="L4" id="line175"><code></code></li><li class="L5" id="line176"><code><span class="pln">    </span><span class="com">// Query elements</span></code></li><li class="L6" id="line177"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L7" id="line178"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">toggleLabel </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-link__label'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">);</span></code></li><li class="L8" id="line179"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">back </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L9" id="line180"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">inner </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">innerSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L0" id="line181"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">itemsList </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">listSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L1" id="line182"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">btnPrevious </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">buttonPreviousSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L2" id="line183"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">btnNext </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">buttonNextSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L3" id="line184"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">itemSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L4" id="line185"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItems </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItemSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L5" id="line186"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">links </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">linkSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L6" id="line187"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">headerBanner </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-site-header__banner'</span><span class="pun">,</span><span class="pln"> document</span><span class="pun">);</span></code></li><li class="L7" id="line188"><code></code></li><li class="L8" id="line189"><code><span class="pln">    </span><span class="com">// Check if we should use desktop display (it does not rely only on breakpoints)</span></code></li><li class="L9" id="line190"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">useDesktopDisplay</span><span class="pun">();</span></code></li><li class="L0" id="line191"><code></code></li><li class="L1" id="line192"><code><span class="pln">    </span><span class="com">// Bind click events on buttons</span></code></li><li class="L2" id="line193"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachClickListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line194"><code><span class="pln">      </span><span class="com">// Open</span></code></li><li class="L4" id="line195"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line196"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnToggle</span><span class="pun">);</span></code></li><li class="L6" id="line197"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L7" id="line198"><code></code></li><li class="L8" id="line199"><code><span class="pln">      </span><span class="com">// Back</span></code></li><li class="L9" id="line200"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">back</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line201"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">back</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnBack</span><span class="pun">);</span></code></li><li class="L1" id="line202"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">back</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'keyup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboard</span><span class="pun">);</span></code></li><li class="L2" id="line203"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L3" id="line204"><code></code></li><li class="L4" id="line205"><code><span class="pln">      </span><span class="com">// Global click</span></code></li><li class="L5" id="line206"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachClickListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line207"><code><span class="pln">        document</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickGlobal</span><span class="pun">);</span></code></li><li class="L7" id="line208"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L8" id="line209"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9" id="line210"><code></code></li><li class="L0" id="line211"><code><span class="pln">    </span><span class="com">// Bind event on menu links</span></code></li><li class="L1" id="line212"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">links</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line213"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">links</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">link</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line214"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachFocusListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line215"><code><span class="pln">          link</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'focusout'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFocusOut</span><span class="pun">);</span></code></li><li class="L5" id="line216"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L6" id="line217"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachKeyListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line218"><code><span class="pln">          link</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'keyup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboard</span><span class="pun">);</span></code></li><li class="L8" id="line219"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9" id="line220"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L0" id="line221"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1" id="line222"><code></code></li><li class="L2" id="line223"><code><span class="pln">    </span><span class="com">// Bind event on sub menu links</span></code></li><li class="L3" id="line224"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItems</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line225"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItems</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">subItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line226"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> subLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__sublink'</span><span class="pun">,</span><span class="pln"> subItem</span><span class="pun">);</span></code></li><li class="L6" id="line227"><code></code></li><li class="L7" id="line228"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachKeyListener </span><span class="pun">&&</span><span class="pln"> subLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line229"><code><span class="pln">          subLink</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnSubitem</span><span class="pun">);</span></code></li><li class="L9" id="line230"><code><span class="pln">          subLink</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'keyup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboard</span><span class="pun">);</span></code></li><li class="L0" id="line231"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1" id="line232"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachFocusListener </span><span class="pun">&&</span><span class="pln"> subLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line233"><code><span class="pln">          subLink</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'focusout'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFocusOut</span><span class="pun">);</span></code></li><li class="L3" id="line234"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4" id="line235"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L5" id="line236"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6" id="line237"><code></code></li><li class="L7" id="line238"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> infoLinks </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__info-link   '</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L8" id="line239"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">infoLinks</span><span class="pun">.</span><span class="pln">length </span><span class="pun">></span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line240"><code><span class="pln">      infoLinks</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">infoLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line241"><code><span class="pln">        infoLink</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'keyup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboard</span><span class="pun">);</span></code></li><li class="L1" id="line242"><code><span class="pln">        infoLink</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'blur'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFocusOut</span><span class="pun">);</span></code></li><li class="L2" id="line243"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L3" id="line244"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4" id="line245"><code></code></li><li class="L5" id="line246"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> seeAllLinks </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__see-all a'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L6" id="line247"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">seeAllLinks</span><span class="pun">.</span><span class="pln">length </span><span class="pun">></span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line248"><code><span class="pln">      seeAllLinks</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">seeAll</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line249"><code><span class="pln">        seeAll</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'keyup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboard</span><span class="pun">);</span></code></li><li class="L9" id="line250"><code><span class="pln">        seeAll</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'blur'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFocusOut</span><span class="pun">);</span></code></li><li class="L0" id="line251"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L1" id="line252"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L2" id="line253"><code></code></li><li class="L3" id="line254"><code><span class="pln">    </span><span class="com">// Bind global keyboard events</span></code></li><li class="L4" id="line255"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachKeyListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line256"><code><span class="pln">      document</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'keyup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboardGlobal</span><span class="pun">);</span></code></li><li class="L6" id="line257"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7" id="line258"><code></code></li><li class="L8" id="line259"><code><span class="pln">    </span><span class="com">// Bind resize events</span></code></li><li class="L9" id="line260"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachResizeListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line261"><code><span class="pln">      window</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'resize'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleResize</span><span class="pun">);</span></code></li><li class="L1" id="line262"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L2" id="line263"><code></code></li><li class="L3" id="line264"><code><span class="pln">    </span><span class="com">// Browse first level items</span></code></li><li class="L4" id="line265"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line266"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line267"><code><span class="pln">        </span><span class="com">// Check menu item display (right to left, full width, ...)</span></code></li><li class="L7" id="line268"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">totalItemsWidth </span><span class="pun">+=</span><span class="pln"> item</span><span class="pun">.</span><span class="pln">offsetWidth</span><span class="pun">;</span></code></li><li class="L8" id="line269"><code></code></li><li class="L9" id="line270"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L0" id="line271"><code><span class="pln">          item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'data-ecl-has-children'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></code></li><li class="L1" id="line272"><code><span class="pln">          item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'data-ecl-has-container'</span><span class="pun">)</span></code></li><li class="L2" id="line273"><code><span class="pln">        </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line274"><code><span class="pln">          </span><span class="com">// Bind click event on menu links</span></code></li><li class="L4" id="line275"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> link </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">linkSelector</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">);</span></code></li><li class="L5" id="line276"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachClickListener </span><span class="pun">&&</span><span class="pln"> link</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line277"><code><span class="pln">            link</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnItem</span><span class="pun">);</span></code></li><li class="L7" id="line278"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L8" id="line279"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9" id="line280"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L0" id="line281"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1" id="line282"><code></code></li><li class="L2" id="line283"><code><span class="pln">    </span><span class="com">// Create a focus trap around the menu</span></code></li><li class="L3" id="line284"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">focusTrap </span><span class="pun">=</span><span class="pln"> createFocusTrap</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line285"><code><span class="pln">      onActivate</span><span class="pun">:</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=></span></code></li><li class="L5" id="line286"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu-trap-is-active'</span><span class="pun">),</span></code></li><li class="L6" id="line287"><code><span class="pln">      onDeactivate</span><span class="pun">:</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=></span></code></li><li class="L7" id="line288"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu-trap-is-active'</span><span class="pun">),</span></code></li><li class="L8" id="line289"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L9" id="line290"><code></code></li><li class="L0" id="line291"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleResize</span><span class="pun">();</span></code></li><li class="L1" id="line292"><code><span class="pln">    </span><span class="com">// Set ecl initialized attribute</span></code></li><li class="L2" id="line293"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'data-ecl-auto-initialized'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">);</span></code></li><li class="L3" id="line294"><code><span class="pln">    ECL</span><span class="pun">.</span><span class="pln">components</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L4" id="line295"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L5" id="line296"><code></code></li><li class="L6" id="line297"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L7" id="line298"><code><span class="com">   * Register a callback function for a specific event.</span></code></li><li class="L8" id="line299"><code><span class="com">   *</span></code></li><li class="L9" id="line300"><code><span class="com">   * @param {string} eventName - The name of the event to listen for.</span></code></li><li class="L0" id="line301"><code><span class="com">   * @param {Function} callback - The callback function to be invoked when the event occurs.</span></code></li><li class="L1" id="line302"><code><span class="com">   * @returns {void}</span></code></li><li class="L2" id="line303"><code><span class="com">   * @memberof MegaMenu</span></code></li><li class="L3" id="line304"><code><span class="com">   * @instance</span></code></li><li class="L4" id="line305"><code><span class="com">   *</span></code></li><li class="L5" id="line306"><code><span class="com">   * @example</span></code></li><li class="L6" id="line307"><code><span class="com">   * // Registering a callback for the 'onOpen' event</span></code></li><li class="L7" id="line308"><code><span class="com">   * megaMenu.on('onOpen', (event) => {</span></code></li><li class="L8" id="line309"><code><span class="com">   *   console.log('Open event occurred!', event);</span></code></li><li class="L9" id="line310"><code><span class="com">   * });</span></code></li><li class="L0" id="line311"><code><span class="com">   */</span></code></li><li class="L1" id="line312"><code><span class="pln">  on</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line313"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">eventManager</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">);</span></code></li><li class="L3" id="line314"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L4" id="line315"><code></code></li><li class="L5" id="line316"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L6" id="line317"><code><span class="com">   * Trigger a component event.</span></code></li><li class="L7" id="line318"><code><span class="com">   *</span></code></li><li class="L8" id="line319"><code><span class="com">   * @param {string} eventName - The name of the event to trigger.</span></code></li><li class="L9" id="line320"><code><span class="com">   * @param {any} eventData - Data associated with the event.</span></code></li><li class="L0" id="line321"><code><span class="com">   * @memberof MegaMenu</span></code></li><li class="L1" id="line322"><code><span class="com">   */</span></code></li><li class="L2" id="line323"><code><span class="pln">  trigger</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">,</span><span class="pln"> eventData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line324"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">eventManager</span><span class="pun">.</span><span class="pln">trigger</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">,</span><span class="pln"> eventData</span><span class="pun">);</span></code></li><li class="L4" id="line325"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L5" id="line326"><code></code></li><li class="L6" id="line327"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L7" id="line328"><code><span class="com">   * Destroy component.</span></code></li><li class="L8" id="line329"><code><span class="com">   */</span></code></li><li class="L9" id="line330"><code><span class="pln">  destroy</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line331"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachClickListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line332"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line333"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnToggle</span><span class="pun">);</span></code></li><li class="L3" id="line334"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L4" id="line335"><code></code></li><li class="L5" id="line336"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">back</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line337"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">back</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnBack</span><span class="pun">);</span></code></li><li class="L7" id="line338"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L8" id="line339"><code></code></li><li class="L9" id="line340"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachClickListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line341"><code><span class="pln">        document</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickGlobal</span><span class="pun">);</span></code></li><li class="L1" id="line342"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L2" id="line343"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3" id="line344"><code></code></li><li class="L4" id="line345"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line346"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line347"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L7" id="line348"><code><span class="pln">          item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'data-ecl-has-children'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></code></li><li class="L8" id="line349"><code><span class="pln">          item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'data-ecl-has-container'</span><span class="pun">)</span></code></li><li class="L9" id="line350"><code><span class="pln">        </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line351"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachClickListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line352"><code><span class="pln">            item</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnItem</span><span class="pun">);</span></code></li><li class="L2" id="line353"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L3" id="line354"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4" id="line355"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L5" id="line356"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6" id="line357"><code></code></li><li class="L7" id="line358"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">links</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line359"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">links</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">link</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line360"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachFocusListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line361"><code><span class="pln">          link</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'focusout'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFocusOut</span><span class="pun">);</span></code></li><li class="L1" id="line362"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L2" id="line363"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachKeyListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line364"><code><span class="pln">          link</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'keyup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboard</span><span class="pun">);</span></code></li><li class="L4" id="line365"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L5" id="line366"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L6" id="line367"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7" id="line368"><code></code></li><li class="L8" id="line369"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItems</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line370"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItems</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">subItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line371"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> subLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__sublink'</span><span class="pun">,</span><span class="pln"> subItem</span><span class="pun">);</span></code></li><li class="L1" id="line372"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachKeyListener </span><span class="pun">&&</span><span class="pln"> subLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line373"><code><span class="pln">          subLink</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'keyup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboard</span><span class="pun">);</span></code></li><li class="L3" id="line374"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4" id="line375"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachClickListener </span><span class="pun">&&</span><span class="pln"> subLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line376"><code><span class="pln">          subLink</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'click'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnSubitem</span><span class="pun">);</span></code></li><li class="L6" id="line377"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L7" id="line378"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachFocusListener </span><span class="pun">&&</span><span class="pln"> subLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line379"><code><span class="pln">          subLink</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'focusout'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFocusOut</span><span class="pun">);</span></code></li><li class="L9" id="line380"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L0" id="line381"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L1" id="line382"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L2" id="line383"><code></code></li><li class="L3" id="line384"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachKeyListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line385"><code><span class="pln">      document</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'keyup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleKeyboardGlobal</span><span class="pun">);</span></code></li><li class="L5" id="line386"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6" id="line387"><code></code></li><li class="L7" id="line388"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">attachResizeListener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line389"><code><span class="pln">      window</span><span class="pun">.</span><span class="pln">removeEventListener</span><span class="pun">(</span><span class="str">'resize'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleResize</span><span class="pun">);</span></code></li><li class="L9" id="line390"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0" id="line391"><code></code></li><li class="L1" id="line392"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">closeOpenDropdown</span><span class="pun">();</span></code></li><li class="L2" id="line393"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">enableScroll</span><span class="pun">();</span></code></li><li class="L3" id="line394"><code></code></li><li class="L4" id="line395"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line396"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">removeAttribute</span><span class="pun">(</span><span class="str">'data-ecl-auto-initialized'</span><span class="pun">);</span></code></li><li class="L6" id="line397"><code><span class="pln">      ECL</span><span class="pun">.</span><span class="pln">components</span><span class="pun">.</span><span class="kwd">delete</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L7" id="line398"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8" id="line399"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L9" id="line400"><code></code></li><li class="L0" id="line401"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L1" id="line402"><code><span class="com">   * Disable page scrolling</span></code></li><li class="L2" id="line403"><code><span class="com">   */</span></code></li><li class="L3" id="line404"><code><span class="pln">  disableScroll</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line405"><code><span class="pln">    document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu-prevent-scroll'</span><span class="pun">);</span></code></li><li class="L5" id="line406"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L6" id="line407"><code></code></li><li class="L7" id="line408"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L8" id="line409"><code><span class="com">   * Enable page scrolling</span></code></li><li class="L9" id="line410"><code><span class="com">   */</span></code></li><li class="L0" id="line411"><code><span class="pln">  enableScroll</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line412"><code><span class="pln">    document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu-prevent-scroll'</span><span class="pun">);</span></code></li><li class="L2" id="line413"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L3" id="line414"><code></code></li><li class="L4" id="line415"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L5" id="line416"><code><span class="com">   * Check if desktop display has to be used</span></code></li><li class="L6" id="line417"><code><span class="com">   * - not using a phone or tablet (whatever the screen size is)</span></code></li><li class="L7" id="line418"><code><span class="com">   * - not having hamburger menu on screen</span></code></li><li class="L8" id="line419"><code><span class="com">   */</span></code></li><li class="L9" id="line420"><code><span class="pln">  useDesktopDisplay</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line421"><code><span class="pln">    </span><span class="com">// Detect mobile devices</span></code></li><li class="L1" id="line422"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isMobile</span><span class="pun">.</span><span class="pln">isMobileOnly</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line423"><code><span class="pln">      </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L3" id="line424"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4" id="line425"><code></code></li><li class="L5" id="line426"><code><span class="pln">    </span><span class="com">// Force mobile display on tablet</span></code></li><li class="L6" id="line427"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isMobile</span><span class="pun">.</span><span class="pln">isTablet</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line428"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu--forced-mobile'</span><span class="pun">);</span></code></li><li class="L8" id="line429"><code><span class="pln">      </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L9" id="line430"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0" id="line431"><code></code></li><li class="L1" id="line432"><code><span class="pln">    </span><span class="com">// After all that, check if the hamburger button is displayed</span></code></li><li class="L2" id="line433"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">innerWidth </span><span class="pun">&lt;</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">breakpointL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line434"><code><span class="pln">      </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L4" id="line435"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5" id="line436"><code></code></li><li class="L6" id="line437"><code><span class="pln">    </span><span class="com">// Everything is fine to use desktop display</span></code></li><li class="L7" id="line438"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu--forced-mobile'</span><span class="pun">);</span></code></li><li class="L8" id="line439"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L9" id="line440"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L0" id="line441"><code></code></li><li class="L1" id="line442"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L2" id="line443"><code><span class="com">   * Reset the styles set by the script</span></code></li><li class="L3" id="line444"><code><span class="com">   *</span></code></li><li class="L4" id="line445"><code><span class="com">   * @param {string} desktop or mobile</span></code></li><li class="L5" id="line446"><code><span class="com">   */</span></code></li><li class="L6" id="line447"><code><span class="pln">  resetStyles</span><span class="pun">(</span><span class="pln">viewport</span><span class="pun">,</span><span class="pln"> compact</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line448"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> infoPanels </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__info'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L8" id="line449"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> subLists </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__sublist'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L9" id="line450"><code></code></li><li class="L0" id="line451"><code><span class="pln">    </span><span class="com">// Remove display:none from the sublists</span></code></li><li class="L1" id="line452"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">subLists </span><span class="pun">&&</span><span class="pln"> viewport </span><span class="pun">===</span><span class="pln"> </span><span class="str">'mobile'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line453"><code><span class="pln">      subLists</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line454"><code><span class="pln">        list</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L4" id="line455"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L5" id="line456"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> megaMenus </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span></code></li><li class="L6" id="line457"><code><span class="pln">        </span><span class="str">'.ecl-mega-menu__item > .ecl-mega-menu__wrapper > .ecl-container > [data-ecl-mega-menu-mega]'</span><span class="pun">,</span></code></li><li class="L7" id="line458"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span></code></li><li class="L8" id="line459"><code><span class="pln">      </span><span class="pun">);</span></code></li><li class="L9" id="line460"><code><span class="pln">      megaMenus</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">menu</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line461"><code><span class="pln">        menu</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L1" id="line462"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L2" id="line463"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> itemExpanded </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L3" id="line464"><code><span class="pln">        </span><span class="str">'.ecl-mega-menu__item--expanded'</span><span class="pun">,</span></code></li><li class="L4" id="line465"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span></code></li><li class="L5" id="line466"><code><span class="pln">      </span><span class="pun">);</span></code></li><li class="L6" id="line467"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">itemExpanded</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line468"><code><span class="pln">        itemExpanded</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L8" id="line469"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L9" id="line470"><code><span class="pln">      </span><span class="com">// Two panels are opened</span></code></li><li class="L0" id="line471"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel</span><span class="pun">.</span><span class="pln">num </span><span class="pun">===</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line472"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> subItemExpanded </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L2" id="line473"><code><span class="pln">          </span><span class="str">'.ecl-mega-menu__subitem--expanded'</span><span class="pun">,</span></code></li><li class="L3" id="line474"><code><span class="pln">          </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span></code></li><li class="L4" id="line475"><code><span class="pln">        </span><span class="pun">);</span></code></li><li class="L5" id="line476"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">subItemExpanded</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line477"><code><span class="pln">          subItemExpanded</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span></code></li><li class="L7" id="line478"><code><span class="pln">            </span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">,</span></code></li><li class="L8" id="line479"><code><span class="pln">          </span><span class="pun">);</span></code></li><li class="L9" id="line480"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L0" id="line481"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> menuItem </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel</span><span class="pun">.</span><span class="pln">item</span><span class="pun">;</span></code></li><li class="L1" id="line482"><code><span class="pln">        </span><span class="com">// Hide siblings</span></code></li><li class="L2" id="line483"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> siblings </span><span class="pun">=</span><span class="pln"> menuItem</span><span class="pun">.</span><span class="pln">parentNode</span><span class="pun">.</span><span class="pln">childNodes</span><span class="pun">;</span></code></li><li class="L3" id="line484"><code><span class="pln">        siblings</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">sibling</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line485"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sibling </span><span class="pun">!==</span><span class="pln"> menuItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line486"><code><span class="pln">            sibling</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">display </span><span class="pun">=</span><span class="pln"> </span><span class="str">'none'</span><span class="pun">;</span></code></li><li class="L6" id="line487"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L7" id="line488"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L8" id="line489"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L9" id="line490"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">subLists </span><span class="pun">&&</span><span class="pln"> viewport </span><span class="pun">===</span><span class="pln"> </span><span class="str">'desktop'</span><span class="pln"> </span><span class="pun">&&</span><span class="pln"> </span><span class="pun">!</span><span class="pln">compact</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line491"><code><span class="pln">      </span><span class="com">// Reset styles for the sublist and subitems</span></code></li><li class="L1" id="line492"><code><span class="pln">      subLists</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line493"><code><span class="pln">        list</span><span class="pun">.</span><span class="pln">childNodes</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line494"><code><span class="pln">          item</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">display </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L4" id="line495"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L5" id="line496"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L6" id="line497"><code></code></li><li class="L7" id="line498"><code><span class="pln">      infoPanels</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">info</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line499"><code><span class="pln">        info</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L9" id="line500"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L0" id="line501"><code></code></li><li class="L1" id="line502"><code><span class="pln">      </span><span class="com">// Check if we have an open item, if we don't hide the overlay and enable scroll</span></code></li><li class="L2" id="line503"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> currentItems </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L3" id="line504"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> currentItem </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L4" id="line505"><code><span class="pln">        </span><span class="str">'.ecl-mega-menu__subitem--expanded'</span><span class="pun">,</span></code></li><li class="L5" id="line506"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span></code></li><li class="L6" id="line507"><code><span class="pln">      </span><span class="pun">);</span></code></li><li class="L7" id="line508"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">currentItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line509"><code><span class="pln">        currentItems</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">currentItem</span><span class="pun">);</span></code></li><li class="L9" id="line510"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L0" id="line511"><code></code></li><li class="L1" id="line512"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> currentSubItem </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L2" id="line513"><code><span class="pln">        </span><span class="str">'.ecl-mega-menu__item--expanded'</span><span class="pun">,</span></code></li><li class="L3" id="line514"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span></code></li><li class="L4" id="line515"><code><span class="pln">      </span><span class="pun">);</span></code></li><li class="L5" id="line516"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">currentSubItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line517"><code><span class="pln">        currentItems</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">currentSubItem</span><span class="pun">);</span></code></li><li class="L7" id="line518"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L8" id="line519"><code></code></li><li class="L9" id="line520"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">currentItems</span><span class="pun">.</span><span class="pln">length </span><span class="pun">></span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line521"><code><span class="pln">        currentItems</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">current</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line522"><code><span class="pln">          current</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L2" id="line523"><code><span class="pln">          </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">checkDropdownHeight</span><span class="pun">(</span><span class="pln">current</span><span class="pun">);</span></code></li><li class="L3" id="line524"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L4" id="line525"><code><span class="pln">      </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line526"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L6" id="line527"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">removeAttribute</span><span class="pun">(</span><span class="str">'data-expanded'</span><span class="pun">);</span></code></li><li class="L7" id="line528"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L8" id="line529"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">enableScroll</span><span class="pun">();</span></code></li><li class="L9" id="line530"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L0" id="line531"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">viewport </span><span class="pun">===</span><span class="pln"> </span><span class="str">'desktop'</span><span class="pln"> </span><span class="pun">&&</span><span class="pln"> compact</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line532"><code><span class="pln">      infoPanels</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">info</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line533"><code><span class="pln">        info</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L3" id="line534"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L4" id="line535"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5" id="line536"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L6" id="line537"><code></code></li><li class="L7" id="line538"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L8" id="line539"><code><span class="com">   * Trigger events on resize</span></code></li><li class="L9" id="line540"><code><span class="com">   * Uses a debounce, for performance</span></code></li><li class="L0" id="line541"><code><span class="com">   */</span></code></li><li class="L1" id="line542"><code><span class="pln">  handleResize</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line543"><code><span class="pln">    clearTimeout</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">resizeTimer</span><span class="pun">);</span></code></li><li class="L3" id="line544"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">resizeTimer </span><span class="pun">=</span><span class="pln"> setTimeout</span><span class="pun">(()</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line545"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> screenWidth </span><span class="pun">=</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">innerWidth</span><span class="pun">;</span></code></li><li class="L5" id="line546"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">prevScreenWidth </span><span class="pun">!==</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line547"><code><span class="pln">        </span><span class="com">// Check if the transition involves crossing the L breakpoint</span></code></li><li class="L7" id="line548"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> isTransition </span><span class="pun">=</span></code></li><li class="L8" id="line549"><code><span class="pln">          </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">prevScreenWidth </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">breakpointL </span><span class="pun">&&</span></code></li><li class="L9" id="line550"><code><span class="pln">            screenWidth </span><span class="pun">></span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">breakpointL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></code></li><li class="L0" id="line551"><code><span class="pln">          </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">prevScreenWidth </span><span class="pun">></span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">breakpointL </span><span class="pun">&&</span></code></li><li class="L1" id="line552"><code><span class="pln">            screenWidth </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">breakpointL</span><span class="pun">);</span></code></li><li class="L2" id="line553"><code><span class="pln">        </span><span class="com">// If we are moving in or out the L breakpoint, reset the styles</span></code></li><li class="L3" id="line554"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isTransition</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line555"><code><span class="pln">          </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">resetStyles</span><span class="pun">(</span></code></li><li class="L5" id="line556"><code><span class="pln">            screenWidth </span><span class="pun">></span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">breakpointL </span><span class="pun">?</span><span class="pln"> </span><span class="str">'desktop'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'mobile'</span><span class="pun">,</span></code></li><li class="L6" id="line557"><code><span class="pln">          </span><span class="pun">);</span></code></li><li class="L7" id="line558"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8" id="line559"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">prevScreenWidth </span><span class="pun">></span><span class="pln"> </span><span class="lit">1140</span><span class="pln"> </span><span class="pun">&&</span><span class="pln"> screenWidth </span><span class="pun">></span><span class="pln"> </span><span class="lit">996</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line560"><code><span class="pln">          </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">resetStyles</span><span class="pun">(</span><span class="str">'desktop'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L0" id="line561"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1" id="line562"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L2" id="line563"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">useDesktopDisplay</span><span class="pun">();</span></code></li><li class="L3" id="line564"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isLarge </span><span class="pun">=</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">innerWidth </span><span class="pun">></span><span class="pln"> </span><span class="lit">1140</span><span class="pun">;</span></code></li><li class="L4" id="line565"><code><span class="pln">      </span><span class="com">// Update previous screen width</span></code></li><li class="L5" id="line566"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">prevScreenWidth </span><span class="pun">=</span><span class="pln"> screenWidth</span><span class="pun">;</span></code></li><li class="L6" id="line567"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu--forced-mobile'</span><span class="pun">);</span></code></li><li class="L7" id="line568"><code><span class="pln">      </span><span class="com">// RTL</span></code></li><li class="L8" id="line569"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">direction </span><span class="pun">=</span><span class="pln"> getComputedStyle</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">).</span><span class="pln">direction</span><span class="pun">;</span></code></li><li class="L9" id="line570"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">direction </span><span class="pun">===</span><span class="pln"> </span><span class="str">'rtl'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line571"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu--rtl'</span><span class="pun">);</span></code></li><li class="L1" id="line572"><code><span class="pln">      </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line573"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu--rtl'</span><span class="pun">);</span></code></li><li class="L3" id="line574"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L4" id="line575"><code><span class="pln">      </span><span class="com">// Check droopdown height if needed</span></code></li><li class="L5" id="line576"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> expanded </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__item--expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L6" id="line577"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">expanded </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line578"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">checkDropdownHeight</span><span class="pun">(</span><span class="pln">expanded</span><span class="pun">);</span></code></li><li class="L8" id="line579"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L9" id="line580"><code><span class="pln">      </span><span class="com">// Check the menu position</span></code></li><li class="L0" id="line581"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">positionMenuOverlay</span><span class="pun">();</span></code></li><li class="L1" id="line582"><code><span class="pln">    </span><span class="pun">},</span><span class="pln"> </span><span class="lit">200</span><span class="pun">);</span></code></li><li class="L2" id="line583"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L3" id="line584"><code></code></li><li class="L4" id="line585"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L5" id="line586"><code><span class="com">   * Calculate dropdown height dynamically</span></code></li><li class="L6" id="line587"><code><span class="com">   *</span></code></li><li class="L7" id="line588"><code><span class="com">   * @param {Node} menuItem</span></code></li><li class="L8" id="line589"><code><span class="com">   */</span></code></li><li class="L9" id="line590"><code><span class="pln">  checkDropdownHeight</span><span class="pun">(</span><span class="pln">menuItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line591"><code><span class="pln">    setTimeout</span><span class="pun">(()</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line592"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> viewportHeight </span><span class="pun">=</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">innerHeight</span><span class="pun">;</span></code></li><li class="L2" id="line593"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> infoPanel </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__info'</span><span class="pun">,</span><span class="pln"> menuItem</span><span class="pun">);</span></code></li><li class="L3" id="line594"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> mainPanel </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__mega'</span><span class="pun">,</span><span class="pln"> menuItem</span><span class="pun">);</span></code></li><li class="L4" id="line595"><code><span class="pln">      let infoPanelHeight </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L5" id="line596"><code></code></li><li class="L6" id="line597"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line598"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> heights </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L8" id="line599"><code><span class="pln">        let height </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L9" id="line600"><code><span class="pln">        let secondPanel </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L0" id="line601"><code><span class="pln">        let featuredPanel </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L1" id="line602"><code><span class="pln">        let itemsHeight </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L2" id="line603"><code><span class="pln">        let subItemsHeight </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L3" id="line604"><code></code></li><li class="L4" id="line605"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">infoPanel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line606"><code><span class="pln">          infoPanelHeight </span><span class="pun">=</span><span class="pln"> infoPanel</span><span class="pun">.</span><span class="pln">scrollHeight </span><span class="pun">+</span><span class="pln"> </span><span class="lit">16</span><span class="pun">;</span></code></li><li class="L6" id="line607"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L7" id="line608"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">infoPanel </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isLarge</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line609"><code><span class="pln">          heights</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">infoPanelHeight</span><span class="pun">);</span></code></li><li class="L9" id="line610"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">infoPanel </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line611"><code><span class="pln">          itemsHeight </span><span class="pun">=</span><span class="pln"> infoPanelHeight</span><span class="pun">;</span></code></li><li class="L1" id="line612"><code><span class="pln">          subItemsHeight </span><span class="pun">=</span><span class="pln"> infoPanelHeight</span><span class="pun">;</span></code></li><li class="L2" id="line613"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3" id="line614"><code></code></li><li class="L4" id="line615"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mainPanel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line616"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> mainTop </span><span class="pun">=</span><span class="pln"> mainPanel</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">().</span><span class="pln">top</span><span class="pun">;</span></code></li><li class="L6" id="line617"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__sublist'</span><span class="pun">,</span><span class="pln"> mainPanel</span><span class="pun">);</span></code></li><li class="L7" id="line618"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line619"><code><span class="pln">            </span><span class="kwd">const</span><span class="pln"> isContainer </span><span class="pun">=</span><span class="pln"> menuItem</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span></code></li><li class="L9" id="line620"><code><span class="pln">              </span><span class="str">'ecl-mega-menu__item--has-container'</span><span class="pun">,</span></code></li><li class="L0" id="line621"><code><span class="pln">            </span><span class="pun">);</span></code></li><li class="L1" id="line622"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isContainer</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line623"><code><span class="pln">              </span><span class="kwd">const</span><span class="pln"> container </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L3" id="line624"><code><span class="pln">                </span><span class="str">'.ecl-mega-menu__mega-container'</span><span class="pun">,</span></code></li><li class="L4" id="line625"><code><span class="pln">                menuItem</span><span class="pun">,</span></code></li><li class="L5" id="line626"><code><span class="pln">              </span><span class="pun">);</span></code></li><li class="L6" id="line627"><code><span class="pln">              </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">container</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line628"><code><span class="pln">                container</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${viewportHeight - mainTop}px`</span><span class="pun">;</span></code></li><li class="L8" id="line629"><code><span class="pln">                </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L9" id="line630"><code><span class="pln">              </span><span class="pun">}</span></code></li><li class="L0" id="line631"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L1" id="line632"><code><span class="pln">          </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line633"><code><span class="pln">            </span><span class="kwd">const</span><span class="pln"> items </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">children</span><span class="pun">;</span></code></li><li class="L3" id="line634"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">items</span><span class="pun">.</span><span class="pln">length </span><span class="pun">></span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line635"><code><span class="pln">              </span><span class="typ">Array</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln">items</span><span class="pun">).</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line636"><code><span class="pln">                itemsHeight </span><span class="pun">+=</span><span class="pln"> item</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">().</span><span class="pln">height</span><span class="pun">;</span></code></li><li class="L6" id="line637"><code><span class="pln">              </span><span class="pun">});</span></code></li><li class="L7" id="line638"><code><span class="pln">              heights</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">itemsHeight</span><span class="pun">);</span></code></li><li class="L8" id="line639"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L9" id="line640"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L0" id="line641"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1" id="line642"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> expanded </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L2" id="line643"><code><span class="pln">          </span><span class="str">'.ecl-mega-menu__subitem--expanded'</span><span class="pun">,</span></code></li><li class="L3" id="line644"><code><span class="pln">          menuItem</span><span class="pun">,</span></code></li><li class="L4" id="line645"><code><span class="pln">        </span><span class="pun">);</span></code></li><li class="L5" id="line646"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">expanded</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line647"><code><span class="pln">          secondPanel </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__mega--level-2'</span><span class="pun">,</span><span class="pln"> expanded</span><span class="pun">);</span></code></li><li class="L7" id="line648"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">secondPanel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line649"><code><span class="pln">            </span><span class="kwd">const</span><span class="pln"> subItems </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="str">`${this.subItemSelector} a`</span><span class="pun">,</span><span class="pln"> secondPanel</span><span class="pun">);</span></code></li><li class="L9" id="line650"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">subItems</span><span class="pun">.</span><span class="pln">length </span><span class="pun">></span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line651"><code><span class="pln">              subItems</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line652"><code><span class="pln">                subItemsHeight </span><span class="pun">+=</span><span class="pln"> item</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">().</span><span class="pln">height</span><span class="pun">;</span></code></li><li class="L2" id="line653"><code><span class="pln">              </span><span class="pun">});</span></code></li><li class="L3" id="line654"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L4" id="line655"><code></code></li><li class="L5" id="line656"><code><span class="pln">            heights</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">subItemsHeight</span><span class="pun">);</span></code></li><li class="L6" id="line657"><code><span class="pln">            featuredPanel </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__featured'</span><span class="pun">,</span><span class="pln"> expanded</span><span class="pun">);</span></code></li><li class="L7" id="line658"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">featuredPanel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line659"><code><span class="pln">              heights</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">featuredPanel</span><span class="pun">.</span><span class="pln">scrollHeight</span><span class="pun">);</span></code></li><li class="L9" id="line660"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L0" id="line661"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L1" id="line662"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L2" id="line663"><code></code></li><li class="L3" id="line664"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> maxHeight </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(...</span><span class="pln">heights</span><span class="pun">);</span></code></li><li class="L4" id="line665"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> containerBounding </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">inner</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">();</span></code></li><li class="L5" id="line666"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> containerBottom </span><span class="pun">=</span><span class="pln"> containerBounding</span><span class="pun">.</span><span class="pln">bottom</span><span class="pun">;</span></code></li><li class="L6" id="line667"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> availableHeight </span><span class="pun">=</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">innerHeight </span><span class="pun">-</span><span class="pln"> containerBottom</span><span class="pun">;</span></code></li><li class="L7" id="line668"><code></code></li><li class="L8" id="line669"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">maxHeight </span><span class="pun">></span><span class="pln"> availableHeight</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line670"><code><span class="pln">          height </span><span class="pun">=</span><span class="pln"> availableHeight </span><span class="pun">-</span><span class="pln"> </span><span class="lit">35</span><span class="pun">;</span></code></li><li class="L0" id="line671"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line672"><code><span class="pln">          height </span><span class="pun">=</span><span class="pln"> maxHeight</span><span class="pun">;</span></code></li><li class="L2" id="line673"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3" id="line674"><code></code></li><li class="L4" id="line675"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> wrapper </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__wrapper'</span><span class="pun">,</span><span class="pln"> menuItem</span><span class="pun">);</span></code></li><li class="L5" id="line676"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">wrapper</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line677"><code><span class="pln">          wrapper</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${height}px`</span><span class="pun">;</span></code></li><li class="L7" id="line678"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8" id="line679"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mainPanel </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isLarge</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line680"><code><span class="pln">          mainPanel</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${height}px`</span><span class="pun">;</span></code></li><li class="L0" id="line681"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mainPanel </span><span class="pun">&&</span><span class="pln"> infoPanel </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line682"><code><span class="pln">          mainPanel</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${height - infoPanelHeight}px`</span><span class="pun">;</span></code></li><li class="L2" id="line683"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3" id="line684"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">infoPanel </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isLarge</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line685"><code><span class="pln">          infoPanel</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${height}px`</span><span class="pun">;</span></code></li><li class="L5" id="line686"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L6" id="line687"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">secondPanel </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isLarge</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line688"><code><span class="pln">          secondPanel</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${height}px`</span><span class="pun">;</span></code></li><li class="L8" id="line689"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">secondPanel </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line690"><code><span class="pln">          secondPanel</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${height - infoPanelHeight}px`</span><span class="pun">;</span></code></li><li class="L0" id="line691"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1" id="line692"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">featuredPanel </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isLarge</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line693"><code><span class="pln">          featuredPanel</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${height}px`</span><span class="pun">;</span></code></li><li class="L3" id="line694"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">featuredPanel </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line695"><code><span class="pln">          featuredPanel</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${height - infoPanelHeight}px`</span><span class="pun">;</span></code></li><li class="L5" id="line696"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L6" id="line697"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L7" id="line698"><code><span class="pln">    </span><span class="pun">},</span><span class="pln"> </span><span class="lit">100</span><span class="pun">);</span></code></li><li class="L8" id="line699"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L9" id="line700"><code></code></li><li class="L0" id="line701"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L1" id="line702"><code><span class="com">   * Dinamically set the position of the menu overlay</span></code></li><li class="L2" id="line703"><code><span class="com">   */</span></code></li><li class="L3" id="line704"><code><span class="pln">  positionMenuOverlay</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line705"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> menuOverlay </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__overlay'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L5" id="line706"><code><span class="pln">    let parentLink </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L6" id="line707"><code><span class="pln">    let parentHeight </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L7" id="line708"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line709"><code><span class="pln">      </span><span class="com">// In mobile, we get the bottom position of the site header header</span></code></li><li class="L9" id="line710"><code><span class="pln">      setTimeout</span><span class="pun">(()</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line711"><code><span class="pln">        let header </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L1" id="line712"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel</span><span class="pun">.</span><span class="pln">num </span><span class="pun">===</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line713"><code><span class="pln">          header </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-site-header__banner'</span><span class="pun">,</span><span class="pln"> document</span><span class="pun">);</span></code></li><li class="L3" id="line714"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line715"><code><span class="pln">          header </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-site-header__header'</span><span class="pun">,</span><span class="pln"> document</span><span class="pun">);</span></code></li><li class="L5" id="line716"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L6" id="line717"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">header</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line718"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> position </span><span class="pun">=</span><span class="pln"> header</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">();</span></code></li><li class="L8" id="line719"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> bottomPosition </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">round</span><span class="pun">(</span><span class="pln">position</span><span class="pun">.</span><span class="pln">bottom</span><span class="pun">);</span></code></li><li class="L9" id="line720"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel</span><span class="pun">.</span><span class="pln">num </span><span class="pun">===</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line721"><code><span class="pln">            parentLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L1" id="line722"><code><span class="pln">              </span><span class="str">'.ecl-mega-menu__item--expanded a'</span><span class="pun">,</span></code></li><li class="L2" id="line723"><code><span class="pln">              </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span></code></li><li class="L3" id="line724"><code><span class="pln">            </span><span class="pun">);</span></code></li><li class="L4" id="line725"><code><span class="pln">          </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel</span><span class="pun">.</span><span class="pln">num </span><span class="pun">===</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line726"><code><span class="pln">            parentLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L6" id="line727"><code><span class="pln">              </span><span class="str">'.ecl-mega-menu__subitem--expanded a'</span><span class="pun">,</span></code></li><li class="L7" id="line728"><code><span class="pln">              </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span></code></li><li class="L8" id="line729"><code><span class="pln">            </span><span class="pun">);</span></code></li><li class="L9" id="line730"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L0" id="line731"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">parentLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line732"><code><span class="pln">            </span><span class="kwd">const</span><span class="pln"> parentRect </span><span class="pun">=</span><span class="pln"> parentLink</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">();</span></code></li><li class="L2" id="line733"><code><span class="pln">            parentHeight </span><span class="pun">=</span><span class="pln"> parentRect</span><span class="pun">.</span><span class="pln">height</span><span class="pun">;</span></code></li><li class="L3" id="line734"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L4" id="line735"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">menuOverlay</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line736"><code><span class="pln">            menuOverlay</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${bottomPosition}px`</span><span class="pun">;</span></code></li><li class="L6" id="line737"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L7" id="line738"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">inner</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line739"><code><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">inner</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${bottomPosition}px`</span><span class="pun">;</span></code></li><li class="L9" id="line740"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L0" id="line741"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> wrappers </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__wrapper'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L1" id="line742"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">wrappers</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line743"><code><span class="pln">            wrappers</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">wrapper</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line744"><code><span class="pln">              wrapper</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> parentLink</span></code></li><li class="L4" id="line745"><code><span class="pln">                </span><span class="pun">?</span><span class="pln"> </span><span class="str">`${parentHeight}px`</span></code></li><li class="L5" id="line746"><code><span class="pln">                </span><span class="pun">:</span><span class="pln"> </span><span class="str">`${bottomPosition}px`</span><span class="pun">;</span></code></li><li class="L6" id="line747"><code><span class="pln">            </span><span class="pun">});</span></code></li><li class="L7" id="line748"><code><span class="pln">          </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel</span><span class="pun">.</span><span class="pln">num </span><span class="pun">===</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&&</span><span class="pln"> parentLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line749"><code><span class="pln">            </span><span class="kwd">const</span><span class="pln"> infoPanel </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L9" id="line750"><code><span class="pln">              </span><span class="str">'.ecl-mega-menu__info'</span><span class="pun">,</span></code></li><li class="L0" id="line751"><code><span class="pln">              parentLink</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">'.ecl-container'</span><span class="pun">),</span></code></li><li class="L1" id="line752"><code><span class="pln">            </span><span class="pun">);</span></code></li><li class="L2" id="line753"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">infoPanel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line754"><code><span class="pln">              infoPanel</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${parentHeight - 2}px`</span><span class="pun">;</span></code></li><li class="L4" id="line755"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L5" id="line756"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L6" id="line757"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L7" id="line758"><code><span class="pln">      </span><span class="pun">},</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L8" id="line759"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line760"><code><span class="pln">      setTimeout</span><span class="pun">(()</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line761"><code><span class="pln">        </span><span class="com">// In desktop we get the bottom position of the whole site header</span></code></li><li class="L1" id="line762"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> siteHeader </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-site-header'</span><span class="pun">,</span><span class="pln"> document</span><span class="pun">);</span></code></li><li class="L2" id="line763"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">siteHeader</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line764"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> headerRect </span><span class="pun">=</span><span class="pln"> siteHeader</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">();</span></code></li><li class="L4" id="line765"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> headerBottom </span><span class="pun">=</span><span class="pln"> headerRect</span><span class="pun">.</span><span class="pln">bottom</span><span class="pun">;</span></code></li><li class="L5" id="line766"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> item </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">itemSelector</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L6" id="line767"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> rect </span><span class="pun">=</span><span class="pln"> item</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">();</span></code></li><li class="L7" id="line768"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> rectHeight </span><span class="pun">=</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">height</span><span class="pun">;</span></code></li><li class="L8" id="line769"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> wrappers </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__wrapper'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L9" id="line770"><code></code></li><li class="L0" id="line771"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">wrappers</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line772"><code><span class="pln">            wrappers</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">wrapper</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line773"><code><span class="pln">              wrapper</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${rectHeight}px`</span><span class="pun">;</span></code></li><li class="L3" id="line774"><code><span class="pln">            </span><span class="pun">});</span></code></li><li class="L4" id="line775"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L5" id="line776"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">menuOverlay</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line777"><code><span class="pln">            menuOverlay</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${headerBottom}px`</span><span class="pun">;</span></code></li><li class="L7" id="line778"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L8" id="line779"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line780"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> bottomPosition </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">getBoundingClientRect</span><span class="pun">().</span><span class="pln">bottom</span><span class="pun">;</span></code></li><li class="L0" id="line781"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">menuOverlay</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line782"><code><span class="pln">            menuOverlay</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">`${bottomPosition}px`</span><span class="pun">;</span></code></li><li class="L2" id="line783"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L3" id="line784"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4" id="line785"><code><span class="pln">      </span><span class="pun">},</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L5" id="line786"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6" id="line787"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L7" id="line788"><code></code></li><li class="L8" id="line789"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L9" id="line790"><code><span class="com">   * Handles keyboard events specific to the menu.</span></code></li><li class="L0" id="line791"><code><span class="com">   *</span></code></li><li class="L1" id="line792"><code><span class="com">   * @param {Event} e</span></code></li><li class="L2" id="line793"><code><span class="com">   */</span></code></li><li class="L3" id="line794"><code><span class="pln">  handleKeyboard</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line795"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> element </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">;</span></code></li><li class="L5" id="line796"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> cList </span><span class="pun">=</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">;</span></code></li><li class="L6" id="line797"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> menuExpanded </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">);</span></code></li><li class="L7" id="line798"><code></code></li><li class="L8" id="line799"><code><span class="pln">    </span><span class="com">// Detect press on Escape</span></code></li><li class="L9" id="line800"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'Escape'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'Esc'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line801"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">document</span><span class="pun">.</span><span class="pln">activeElement </span><span class="pun">===</span><span class="pln"> element</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line802"><code><span class="pln">        element</span><span class="pun">.</span><span class="pln">blur</span><span class="pun">();</span></code></li><li class="L2" id="line803"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L3" id="line804"><code></code></li><li class="L4" id="line805"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">menuExpanded </span><span class="pun">===</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line806"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">closeOpenDropdown</span><span class="pun">();</span></code></li><li class="L6" id="line807"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L7" id="line808"><code><span class="pln">      </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L8" id="line809"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9" id="line810"><code><span class="pln">    </span><span class="com">// Handle Keyboard on the first panel</span></code></li><li class="L0" id="line811"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__info-link'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line812"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowUp'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line813"><code><span class="pln">        </span><span class="com">// Focus on the expanded nav item</span></code></li><li class="L3" id="line814"><code><span class="pln">        queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__item--expanded a'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">).</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L4" id="line815"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L5" id="line816"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowDown'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowRight'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line817"><code><span class="pln">        </span><span class="com">// First item in the open dropdown.</span></code></li><li class="L7" id="line818"><code><span class="pln">        element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">nextSibling</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L8" id="line819"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L9" id="line820"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0" id="line821"><code></code></li><li class="L1" id="line822"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line823"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowUp'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line824"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> back </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__back'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L4" id="line825"><code><span class="pln">        back</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L5" id="line826"><code><span class="pln">        </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L6" id="line827"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L7" id="line828"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowDown'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line829"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> moreLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L9" id="line830"><code><span class="pln">          </span><span class="str">'.ecl-mega-menu__info-link'</span><span class="pun">,</span></code></li><li class="L0" id="line831"><code><span class="pln">          e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">nextSibling</span><span class="pun">,</span></code></li><li class="L1" id="line832"><code><span class="pln">        </span><span class="pun">);</span></code></li><li class="L2" id="line833"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">moreLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line834"><code><span class="pln">          moreLink</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L4" id="line835"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L5" id="line836"><code><span class="pln">          </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu--two-panels'</span><span class="pun">)</span></code></li><li class="L6" id="line837"><code><span class="pln">        </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line838"><code><span class="pln">          </span><span class="com">// We are in the second panel</span></code></li><li class="L8" id="line839"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> mega </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__mega'</span><span class="pun">);</span></code></li><li class="L9" id="line840"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L0" id="line841"><code><span class="pln">            </span><span class="str">'.ecl-mega-menu__info--has-link'</span><span class="pun">,</span></code></li><li class="L1" id="line842"><code><span class="pln">            mega</span><span class="pun">.</span><span class="pln">parentNode</span><span class="pun">,</span></code></li><li class="L2" id="line843"><code><span class="pln">          </span><span class="pun">);</span></code></li><li class="L3" id="line844"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">info</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line845"><code><span class="pln">            </span><span class="kwd">const</span><span class="pln"> more </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__info-link'</span><span class="pun">,</span><span class="pln"> info</span><span class="pun">);</span></code></li><li class="L5" id="line846"><code><span class="pln">            more</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L6" id="line847"><code><span class="pln">          </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line848"><code><span class="pln">            mega</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L8" id="line849"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L9" id="line850"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line851"><code><span class="pln">          </span><span class="com">// First element in the open dropwdown</span></code></li><li class="L1" id="line852"><code><span class="pln">          e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">nextSibling</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">lastElementChild</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L2" id="line853"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3" id="line854"><code></code></li><li class="L4" id="line855"><code><span class="pln">        </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L5" id="line856"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L6" id="line857"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7" id="line858"><code></code></li><li class="L8" id="line859"><code><span class="pln">    </span><span class="com">// Handle keyboard on the see all links</span></code></li><li class="L9" id="line860"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__see-all'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line861"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowUp'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line862"><code><span class="pln">        </span><span class="com">// Focus on the last element of the sub-list</span></code></li><li class="L2" id="line863"><code><span class="pln">        element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">previousSibling</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L3" id="line864"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L4" id="line865"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowDown'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line866"><code><span class="pln">        </span><span class="com">// Focus on the fi</span></code></li><li class="L6" id="line867"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> featured </span><span class="pun">=</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">nextSibling</span><span class="pun">;</span></code></li><li class="L7" id="line868"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">featured</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line869"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> focusableSelectors </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L9" id="line870"><code><span class="pln">            </span><span class="str">'a[href]'</span><span class="pun">,</span></code></li><li class="L0" id="line871"><code><span class="pln">            </span><span class="str">'button:not([disabled])'</span><span class="pun">,</span></code></li><li class="L1" id="line872"><code><span class="pln">            </span><span class="str">'input:not([disabled])'</span><span class="pun">,</span></code></li><li class="L2" id="line873"><code><span class="pln">            </span><span class="str">'select:not([disabled])'</span><span class="pun">,</span></code></li><li class="L3" id="line874"><code><span class="pln">            </span><span class="str">'textarea:not([disabled])'</span><span class="pun">,</span></code></li><li class="L4" id="line875"><code><span class="pln">            </span><span class="str">'[tabindex]:not([tabindex="-1"])'</span><span class="pun">,</span></code></li><li class="L5" id="line876"><code><span class="pln">          </span><span class="pun">];</span></code></li><li class="L6" id="line877"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> focusableElements </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span></code></li><li class="L7" id="line878"><code><span class="pln">            focusableSelectors</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">', '</span><span class="pun">),</span></code></li><li class="L8" id="line879"><code><span class="pln">            featured</span><span class="pun">,</span></code></li><li class="L9" id="line880"><code><span class="pln">          </span><span class="pun">);</span></code></li><li class="L0" id="line881"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">focusableElements</span><span class="pun">.</span><span class="pln">length </span><span class="pun">></span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line882"><code><span class="pln">            focusableElements</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L2" id="line883"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L3" id="line884"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4" id="line885"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L5" id="line886"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6" id="line887"><code><span class="pln">    </span><span class="com">// Handle keyboard on the back button</span></code></li><li class="L7" id="line888"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__back'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line889"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowDown'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line890"><code><span class="pln">        e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L0" id="line891"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> expanded </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L1" id="line892"><code><span class="pln">          </span><span class="str">'[aria-expanded="true"]'</span><span class="pun">,</span></code></li><li class="L2" id="line893"><code><span class="pln">          element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">nextSibling</span><span class="pun">,</span></code></li><li class="L3" id="line894"><code><span class="pln">        </span><span class="pun">);</span></code></li><li class="L4" id="line895"><code><span class="pln">        </span><span class="com">// We have an opened list</span></code></li><li class="L5" id="line896"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">expanded</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line897"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> innerExpanded </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L7" id="line898"><code><span class="pln">            </span><span class="str">'.ecl-mega-menu__subitem--expanded'</span><span class="pun">,</span></code></li><li class="L8" id="line899"><code><span class="pln">            expanded</span><span class="pun">,</span></code></li><li class="L9" id="line900"><code><span class="pln">          </span><span class="pun">);</span></code></li><li class="L0" id="line901"><code><span class="pln">          </span><span class="com">// We have an opened sub-list</span></code></li><li class="L1" id="line902"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">innerExpanded</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line903"><code><span class="pln">            queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__parent-link'</span><span class="pun">,</span><span class="pln"> innerExpanded</span><span class="pun">).</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L3" id="line904"><code><span class="pln">          </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line905"><code><span class="pln">            queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__parent-link'</span><span class="pun">,</span><span class="pln"> expanded</span><span class="pun">).</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L5" id="line906"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L6" id="line907"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L7" id="line908"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L8" id="line909"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowUp'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line910"><code><span class="pln">        </span><span class="com">// Focus on the open button</span></code></li><li class="L0" id="line911"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L1" id="line912"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L2" id="line913"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3" id="line914"><code><span class="pln">    </span><span class="com">// Key actions to navigate between first level menu items</span></code></li><li class="L4" id="line915"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__link'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line916"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowLeft'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowUp'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line917"><code><span class="pln">        e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L7" id="line918"><code><span class="pln">        let prevItem </span><span class="pun">=</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">previousSibling</span><span class="pun">;</span></code></li><li class="L8" id="line919"><code></code></li><li class="L9" id="line920"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">prevItem </span><span class="pun">&&</span><span class="pln"> prevItem</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__link'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line921"><code><span class="pln">          prevItem</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L1" id="line922"><code><span class="pln">          </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L2" id="line923"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3" id="line924"><code></code></li><li class="L4" id="line925"><code><span class="pln">        prevItem </span><span class="pun">=</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">previousSibling</span><span class="pun">;</span></code></li><li class="L5" id="line926"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">prevItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line927"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> prevLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__link'</span><span class="pun">,</span><span class="pln"> prevItem</span><span class="pun">);</span></code></li><li class="L7" id="line928"><code></code></li><li class="L8" id="line929"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">prevLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line930"><code><span class="pln">            prevLink</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L0" id="line931"><code><span class="pln">            </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L1" id="line932"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L2" id="line933"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3" id="line934"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L4" id="line935"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowRight'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowDown'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line936"><code><span class="pln">        e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L6" id="line937"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L7" id="line938"><code><span class="pln">          element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="str">'true'</span><span class="pln"> </span><span class="pun">&&</span></code></li><li class="L8" id="line939"><code><span class="pln">          e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowDown'</span></code></li><li class="L9" id="line940"><code><span class="pln">        </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line941"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> infoLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L1" id="line942"><code><span class="pln">            </span><span class="str">'.ecl-mega-menu__info-link'</span><span class="pun">,</span></code></li><li class="L2" id="line943"><code><span class="pln">            element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">,</span></code></li><li class="L3" id="line944"><code><span class="pln">          </span><span class="pun">);</span></code></li><li class="L4" id="line945"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">infoLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line946"><code><span class="pln">            infoLink</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L6" id="line947"><code><span class="pln">            </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L7" id="line948"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L8" id="line949"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9" id="line950"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> nextItem </span><span class="pun">=</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">nextSibling</span><span class="pun">;</span></code></li><li class="L0" id="line951"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nextItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line952"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> nextLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__link'</span><span class="pun">,</span><span class="pln"> nextItem</span><span class="pun">);</span></code></li><li class="L2" id="line953"><code></code></li><li class="L3" id="line954"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nextLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line955"><code><span class="pln">            nextLink</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L5" id="line956"><code><span class="pln">            </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L6" id="line957"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L7" id="line958"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8" id="line959"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L9" id="line960"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0" id="line961"><code><span class="pln">    </span><span class="com">// Key actions to navigate between the sub-links</span></code></li><li class="L1" id="line962"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__sublink'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line963"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowDown'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line964"><code><span class="pln">        e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L4" id="line965"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> nextItem </span><span class="pun">=</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">nextSibling</span><span class="pun">;</span></code></li><li class="L5" id="line966"><code><span class="pln">        let nextLink </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L6" id="line967"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nextItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line968"><code><span class="pln">          nextLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__sublink'</span><span class="pun">,</span><span class="pln"> nextItem</span><span class="pun">);</span></code></li><li class="L8" id="line969"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L9" id="line970"><code><span class="pln">            </span><span class="pun">!</span><span class="pln">nextLink </span><span class="pun">&&</span></code></li><li class="L0" id="line971"><code><span class="pln">            nextItem</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__see-all'</span><span class="pun">)</span></code></li><li class="L1" id="line972"><code><span class="pln">          </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line973"><code><span class="pln">            nextLink </span><span class="pun">=</span><span class="pln"> nextItem</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">;</span></code></li><li class="L3" id="line974"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L4" id="line975"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nextLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line976"><code><span class="pln">            nextLink</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L6" id="line977"><code><span class="pln">            </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L7" id="line978"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L8" id="line979"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9" id="line980"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L0" id="line981"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowUp'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line982"><code><span class="pln">        e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L2" id="line983"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> prevItem </span><span class="pun">=</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">previousSibling</span><span class="pun">;</span></code></li><li class="L3" id="line984"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">prevItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line985"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> prevLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__sublink'</span><span class="pun">,</span><span class="pln"> prevItem</span><span class="pun">);</span></code></li><li class="L5" id="line986"><code></code></li><li class="L6" id="line987"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">prevLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line988"><code><span class="pln">            prevLink</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L8" id="line989"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L9" id="line990"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line991"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> moreLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L1" id="line992"><code><span class="pln">            </span><span class="str">'.ecl-mega-menu__info-link'</span><span class="pun">,</span></code></li><li class="L2" id="line993"><code><span class="pln">            element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">previousSibling</span><span class="pun">,</span></code></li><li class="L3" id="line994"><code><span class="pln">          </span><span class="pun">);</span></code></li><li class="L4" id="line995"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">moreLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line996"><code><span class="pln">            moreLink</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L6" id="line997"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L7" id="line998"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8" id="line999"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L9" id="line1000"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0" id="line1001"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'ArrowRight'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1002"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> expanded </span><span class="pun">=</span></code></li><li class="L2" id="line1003"><code><span class="pln">        element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">;</span></code></li><li class="L3" id="line1004"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">expanded</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line1005"><code><span class="pln">        e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L5" id="line1006"><code><span class="pln">        </span><span class="com">// Focus on the first element in the second panel</span></code></li><li class="L6" id="line1007"><code><span class="pln">        element</span><span class="pun">.</span><span class="pln">nextSibling</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">firstChild</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L7" id="line1008"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L8" id="line1009"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9" id="line1010"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L0" id="line1011"><code></code></li><li class="L1" id="line1012"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L2" id="line1013"><code><span class="com">   * Handles global keyboard events, triggered outside of the menu.</span></code></li><li class="L3" id="line1014"><code><span class="com">   *</span></code></li><li class="L4" id="line1015"><code><span class="com">   * @param {Event} e</span></code></li><li class="L5" id="line1016"><code><span class="com">   */</span></code></li><li class="L6" id="line1017"><code><span class="pln">  handleKeyboardGlobal</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line1018"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> menuExpanded </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">);</span></code></li><li class="L8" id="line1019"><code></code></li><li class="L9" id="line1020"><code><span class="pln">    </span><span class="com">// Detect press on Escape</span></code></li><li class="L0" id="line1021"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'Escape'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">key </span><span class="pun">===</span><span class="pln"> </span><span class="str">'Esc'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1022"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">menuExpanded </span><span class="pun">===</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line1023"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">closeOpenDropdown</span><span class="pun">();</span></code></li><li class="L3" id="line1024"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L4" id="line1025"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5" id="line1026"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L6" id="line1027"><code></code></li><li class="L7" id="line1028"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L8" id="line1029"><code><span class="com">   * Open menu list.</span></code></li><li class="L9" id="line1030"><code><span class="com">   *</span></code></li><li class="L0" id="line1031"><code><span class="com">   * @param {Event} e</span></code></li><li class="L1" id="line1032"><code><span class="com">   *</span></code></li><li class="L2" id="line1033"><code><span class="com">   * @fires MegaMenu#onOpen</span></code></li><li class="L3" id="line1034"><code><span class="com">   */</span></code></li><li class="L4" id="line1035"><code><span class="pln">  handleClickOnOpen</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line1036"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line1037"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnClose</span><span class="pun">(</span><span class="pln">e</span><span class="pun">);</span></code></li><li class="L7" id="line1038"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1039"><code><span class="pln">      e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L9" id="line1040"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">disableScroll</span><span class="pun">();</span></code></li><li class="L0" id="line1041"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">);</span></code></li><li class="L1" id="line1042"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">);</span></code></li><li class="L2" id="line1043"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">inner</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-hidden'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L3" id="line1044"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isOpen </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L4" id="line1045"><code></code></li><li class="L5" id="line1046"><code><span class="pln">      </span><span class="com">// Update label</span></code></li><li class="L6" id="line1047"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> closeLabel </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">labelCloseAttribute</span><span class="pun">);</span></code></li><li class="L7" id="line1048"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">toggleLabel </span><span class="pun">&&</span><span class="pln"> closeLabel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1049"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">toggleLabel</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> closeLabel</span><span class="pun">;</span></code></li><li class="L9" id="line1050"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L0" id="line1051"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">positionMenuOverlay</span><span class="pun">();</span></code></li><li class="L1" id="line1052"><code></code></li><li class="L2" id="line1053"><code><span class="pln">      </span><span class="com">// Focus first element</span></code></li><li class="L3" id="line1054"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">links</span><span class="pun">.</span><span class="pln">length </span><span class="pun">></span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line1055"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">links</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L5" id="line1056"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L6" id="line1057"><code></code></li><li class="L7" id="line1058"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">trigger</span><span class="pun">(</span><span class="str">'onOpen'</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">);</span></code></li><li class="L8" id="line1059"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9" id="line1060"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L0" id="line1061"><code></code></li><li class="L1" id="line1062"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L2" id="line1063"><code><span class="com">   * Close menu list.</span></code></li><li class="L3" id="line1064"><code><span class="com">   *</span></code></li><li class="L4" id="line1065"><code><span class="com">   * @param {Event} e</span></code></li><li class="L5" id="line1066"><code><span class="com">   *</span></code></li><li class="L6" id="line1067"><code><span class="com">   * @fires Menu#onClose</span></code></li><li class="L7" id="line1068"><code><span class="com">   */</span></code></li><li class="L8" id="line1069"><code><span class="pln">  handleClickOnClose</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1070"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line1071"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">focusTrap</span><span class="pun">.</span><span class="pln">deactivate</span><span class="pun">();</span></code></li><li class="L1" id="line1072"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">closeOpenDropdown</span><span class="pun">();</span></code></li><li class="L2" id="line1073"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">trigger</span><span class="pun">(</span><span class="str">'onClose'</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">);</span></code></li><li class="L3" id="line1074"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line1075"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnOpen</span><span class="pun">(</span><span class="pln">e</span><span class="pun">);</span></code></li><li class="L5" id="line1076"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6" id="line1077"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L7" id="line1078"><code></code></li><li class="L8" id="line1079"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L9" id="line1080"><code><span class="com">   * Toggle menu list.</span></code></li><li class="L0" id="line1081"><code><span class="com">   *</span></code></li><li class="L1" id="line1082"><code><span class="com">   * @param {Event} e</span></code></li><li class="L2" id="line1083"><code><span class="com">   */</span></code></li><li class="L3" id="line1084"><code><span class="pln">  handleClickOnToggle</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line1085"><code><span class="pln">    e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L5" id="line1086"><code></code></li><li class="L6" id="line1087"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isOpen</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line1088"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnClose</span><span class="pun">(</span><span class="pln">e</span><span class="pun">);</span></code></li><li class="L8" id="line1089"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1090"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleClickOnOpen</span><span class="pun">(</span><span class="pln">e</span><span class="pun">);</span></code></li><li class="L0" id="line1091"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1" id="line1092"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L2" id="line1093"><code></code></li><li class="L3" id="line1094"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L4" id="line1095"><code><span class="com">   * Get back to previous list (on mobile)</span></code></li><li class="L5" id="line1096"><code><span class="com">   *</span></code></li><li class="L6" id="line1097"><code><span class="com">   * @fires MegaMenu#onBack</span></code></li><li class="L7" id="line1098"><code><span class="com">   */</span></code></li><li class="L8" id="line1099"><code><span class="pln">  handleClickOnBack</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1100"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> infoPanels </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__info'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L0" id="line1101"><code><span class="pln">    infoPanels</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">info</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1102"><code><span class="pln">      info</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L2" id="line1103"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L3" id="line1104"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> level2 </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__subitem--expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">);</span></code></li><li class="L4" id="line1105"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">level2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line1106"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu--two-panels'</span><span class="pun">);</span></code></li><li class="L6" id="line1107"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu--one-panel'</span><span class="pun">);</span></code></li><li class="L7" id="line1108"><code><span class="pln">      level2</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L8" id="line1109"><code><span class="pln">      level2</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span></code></li><li class="L9" id="line1110"><code><span class="pln">        </span><span class="str">'ecl-mega-menu__subitem--expanded'</span><span class="pun">,</span></code></li><li class="L0" id="line1111"><code><span class="pln">        </span><span class="str">'ecl-mega-menu__subitem--current'</span><span class="pun">,</span></code></li><li class="L1" id="line1112"><code><span class="pln">      </span><span class="pun">);</span></code></li><li class="L2" id="line1113"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> itemLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subLinkSelector</span><span class="pun">,</span><span class="pln"> level2</span><span class="pun">);</span></code></li><li class="L3" id="line1114"><code><span class="pln">      itemLink</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L4" id="line1115"><code><span class="pln">      itemLink</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L5" id="line1116"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> siblings </span><span class="pun">=</span><span class="pln"> level2</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">childNodes</span><span class="pun">;</span></code></li><li class="L6" id="line1117"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">siblings</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line1118"><code><span class="pln">        siblings</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">sibling</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1119"><code><span class="pln">          sibling</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">display </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L9" id="line1120"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L0" id="line1121"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L1" id="line1122"><code><span class="pln">      </span><span class="com">// Move the focus to the previously selected item</span></code></li><li class="L2" id="line1123"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backItemLevel2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line1124"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backItemLevel2</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L4" id="line1125"><code><span class="pln">      </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line1126"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> expanded </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L6" id="line1127"><code><span class="pln">          </span><span class="str">'.ecl-mega-menu__item--expanded'</span><span class="pun">,</span></code></li><li class="L7" id="line1128"><code><span class="pln">          </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span></code></li><li class="L8" id="line1129"><code><span class="pln">        </span><span class="pun">);</span></code></li><li class="L9" id="line1130"><code><span class="pln">        queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__parent-link'</span><span class="pun">,</span><span class="pln"> expanded</span><span class="pun">).</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L0" id="line1131"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L1" id="line1132"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel</span><span class="pun">.</span><span class="pln">num </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L2" id="line1133"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line1134"><code><span class="pln">      </span><span class="com">// Remove expanded class from inner menu</span></code></li><li class="L4" id="line1135"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">inner</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__inner--expanded'</span><span class="pun">);</span></code></li><li class="L5" id="line1136"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu--one-panel'</span><span class="pun">);</span></code></li><li class="L6" id="line1137"><code><span class="pln">      </span><span class="com">// Remove css class and attribute from menu items</span></code></li><li class="L7" id="line1138"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1139"><code><span class="pln">        item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span></code></li><li class="L9" id="line1140"><code><span class="pln">          </span><span class="str">'ecl-mega-menu__item--expanded'</span><span class="pun">,</span></code></li><li class="L0" id="line1141"><code><span class="pln">          </span><span class="str">'ecl-mega-menu__item--current'</span><span class="pun">,</span></code></li><li class="L1" id="line1142"><code><span class="pln">        </span><span class="pun">);</span></code></li><li class="L2" id="line1143"><code><span class="pln">        item</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L3" id="line1144"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> itemLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">linkSelector</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">);</span></code></li><li class="L4" id="line1145"><code><span class="pln">        itemLink</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L5" id="line1146"><code><span class="pln">        itemLink</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L6" id="line1147"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L7" id="line1148"><code><span class="pln">      </span><span class="com">// Move the focus to the previously selected item</span></code></li><li class="L8" id="line1149"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backItemLevel1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1150"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backItemLevel1</span><span class="pun">.</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L0" id="line1151"><code><span class="pln">      </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1152"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">firstElementChild</span><span class="pun">.</span><span class="pln">focus</span><span class="pun">();</span></code></li><li class="L2" id="line1153"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L3" id="line1154"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel</span><span class="pun">.</span><span class="pln">num </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L4" id="line1155"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">positionMenuOverlay</span><span class="pun">();</span></code></li><li class="L5" id="line1156"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6" id="line1157"><code></code></li><li class="L7" id="line1158"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">trigger</span><span class="pun">(</span><span class="str">'onBack'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> level</span><span class="pun">:</span><span class="pln"> level2 </span><span class="pun">?</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">});</span></code></li><li class="L8" id="line1159"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L9" id="line1160"><code></code></li><li class="L0" id="line1161"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L1" id="line1162"><code><span class="com">   * Show/hide the first panel</span></code></li><li class="L2" id="line1163"><code><span class="com">   *</span></code></li><li class="L3" id="line1164"><code><span class="com">   * @param {Node} menuItem</span></code></li><li class="L4" id="line1165"><code><span class="com">   * @param {string} op (expand or collapse)</span></code></li><li class="L5" id="line1166"><code><span class="com">   *</span></code></li><li class="L6" id="line1167"><code><span class="com">   * @fires MegaMenu#onOpenPanel</span></code></li><li class="L7" id="line1168"><code><span class="com">   */</span></code></li><li class="L8" id="line1169"><code><span class="pln">  handleFirstPanel</span><span class="pun">(</span><span class="pln">menuItem</span><span class="pun">,</span><span class="pln"> op</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1170"><code><span class="pln">    </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">op</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line1171"><code><span class="pln">      </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'expand'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1172"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">inner</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu__inner--expanded'</span><span class="pun">);</span></code></li><li class="L2" id="line1173"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">positionMenuOverlay</span><span class="pun">();</span></code></li><li class="L3" id="line1174"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">checkDropdownHeight</span><span class="pun">(</span><span class="pln">menuItem</span><span class="pun">);</span></code></li><li class="L4" id="line1175"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'data-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L5" id="line1176"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">);</span></code></li><li class="L6" id="line1177"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu--one-panel'</span><span class="pun">);</span></code></li><li class="L7" id="line1178"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">);</span></code></li><li class="L8" id="line1179"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">disableScroll</span><span class="pun">();</span></code></li><li class="L9" id="line1180"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line1181"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1182"><code><span class="pln">            </span><span class="kwd">const</span><span class="pln"> itemLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">linkSelector</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">);</span></code></li><li class="L2" id="line1183"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item </span><span class="pun">===</span><span class="pln"> menuItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line1184"><code><span class="pln">              item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span></code></li><li class="L4" id="line1185"><code><span class="pln">                </span><span class="str">'ecl-mega-menu__item--expanded'</span><span class="pun">,</span></code></li><li class="L5" id="line1186"><code><span class="pln">                </span><span class="str">'ecl-mega-menu__item--current'</span><span class="pun">,</span></code></li><li class="L6" id="line1187"><code><span class="pln">              </span><span class="pun">);</span></code></li><li class="L7" id="line1188"><code><span class="pln">              item</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">);</span></code></li><li class="L8" id="line1189"><code><span class="pln">              itemLink</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">);</span></code></li><li class="L9" id="line1190"><code><span class="pln">              </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0" id="line1191"><code><span class="pln">                itemLink</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L1" id="line1192"><code><span class="pln">              </span><span class="pun">}</span></code></li><li class="L2" id="line1193"><code><span class="pln">              </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backItemLevel1 </span><span class="pun">=</span><span class="pln"> item</span><span class="pun">;</span></code></li><li class="L3" id="line1194"><code><span class="pln">            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line1195"><code><span class="pln">              item</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L5" id="line1196"><code><span class="pln">              itemLink</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L6" id="line1197"><code><span class="pln">              itemLink</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L7" id="line1198"><code><span class="pln">              item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span></code></li><li class="L8" id="line1199"><code><span class="pln">                </span><span class="str">'ecl-mega-menu__item--current'</span><span class="pun">,</span></code></li><li class="L9" id="line1200"><code><span class="pln">                </span><span class="str">'ecl-mega-menu__item--expanded'</span><span class="pun">,</span></code></li><li class="L0" id="line1201"><code><span class="pln">              </span><span class="pun">);</span></code></li><li class="L1" id="line1202"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L2" id="line1203"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L3" id="line1204"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L4" id="line1205"><code></code></li><li class="L5" id="line1206"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line1207"><code><span class="pln">          num</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span></code></li><li class="L7" id="line1208"><code><span class="pln">          item</span><span class="pun">:</span><span class="pln"> menuItem</span><span class="pun">,</span></code></li><li class="L8" id="line1209"><code><span class="pln">        </span><span class="pun">};</span></code></li><li class="L9" id="line1210"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> details </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> panel</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">:</span><span class="pln"> menuItem </span><span class="pun">};</span></code></li><li class="L0" id="line1211"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">trigger</span><span class="pun">(</span><span class="str">'OnOpenPanel'</span><span class="pun">,</span><span class="pln"> details</span><span class="pun">);</span></code></li><li class="L1" id="line1212"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line1213"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__sublist'</span><span class="pun">,</span><span class="pln"> menuItem</span><span class="pun">);</span></code></li><li class="L3" id="line1214"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line1215"><code><span class="pln">            </span><span class="kwd">const</span><span class="pln"> expandedChild </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln">list</span><span class="pun">.</span><span class="pln">children</span><span class="pun">).</span><span class="pln">find</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span></code></li><li class="L5" id="line1216"><code><span class="pln">              item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">),</span></code></li><li class="L6" id="line1217"><code><span class="pln">            </span><span class="pun">);</span></code></li><li class="L7" id="line1218"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">expandedChild</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1219"><code><span class="pln">              </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleSecondPanel</span><span class="pun">(</span><span class="pln">expandedChild</span><span class="pun">,</span><span class="pln"> </span><span class="str">'expand'</span><span class="pun">);</span></code></li><li class="L9" id="line1220"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L0" id="line1221"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L1" id="line1222"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L2" id="line1223"><code><span class="pln">        </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L3" id="line1224"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L4" id="line1225"><code></code></li><li class="L5" id="line1226"><code><span class="pln">      </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'collapse'</span><span class="pun">:</span></code></li><li class="L6" id="line1227"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">closeOpenDropdown</span><span class="pun">();</span></code></li><li class="L7" id="line1228"><code><span class="pln">        </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L8" id="line1229"><code></code></li><li class="L9" id="line1230"><code><span class="pln">      </span><span class="kwd">default</span><span class="pun">:</span></code></li><li class="L0" id="line1231"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1" id="line1232"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L2" id="line1233"><code></code></li><li class="L3" id="line1234"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L4" id="line1235"><code><span class="com">   * Show/hide the second panel</span></code></li><li class="L5" id="line1236"><code><span class="com">   *</span></code></li><li class="L6" id="line1237"><code><span class="com">   * @param {Node} menuItem</span></code></li><li class="L7" id="line1238"><code><span class="com">   * @param {string} op (expand or collapse)</span></code></li><li class="L8" id="line1239"><code><span class="com">   *</span></code></li><li class="L9" id="line1240"><code><span class="com">   * @fires MegaMenu#onOpenPanel</span></code></li><li class="L0" id="line1241"><code><span class="com">   */</span></code></li><li class="L1" id="line1242"><code><span class="pln">  handleSecondPanel</span><span class="pun">(</span><span class="pln">menuItem</span><span class="pun">,</span><span class="pln"> op</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line1243"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> infoPanel </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L3" id="line1244"><code><span class="pln">      </span><span class="str">'.ecl-mega-menu__info'</span><span class="pun">,</span></code></li><li class="L4" id="line1245"><code><span class="pln">      menuItem</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">'.ecl-container'</span><span class="pun">),</span></code></li><li class="L5" id="line1246"><code><span class="pln">    </span><span class="pun">);</span></code></li><li class="L6" id="line1247"><code><span class="pln">    let siblings</span><span class="pun">;</span></code></li><li class="L7" id="line1248"><code><span class="pln">    </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">op</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1249"><code><span class="pln">      </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'expand'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1250"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu--one-panel'</span><span class="pun">);</span></code></li><li class="L0" id="line1251"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu--two-panels'</span><span class="pun">);</span></code></li><li class="L1" id="line1252"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItems</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line1253"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> itemLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subLinkSelector</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">);</span></code></li><li class="L3" id="line1254"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item </span><span class="pun">===</span><span class="pln"> menuItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line1255"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line1256"><code><span class="pln">              item</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">);</span></code></li><li class="L6" id="line1257"><code><span class="pln">              itemLink</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">);</span></code></li><li class="L7" id="line1258"><code><span class="pln">              </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1259"><code><span class="pln">                </span><span class="com">// We use this class mainly to recover the default behavior of the link.</span></code></li><li class="L9" id="line1260"><code><span class="pln">                itemLink</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L0" id="line1261"><code><span class="pln">              </span><span class="pun">}</span></code></li><li class="L1" id="line1262"><code><span class="pln">              item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu__subitem--expanded'</span><span class="pun">);</span></code></li><li class="L2" id="line1263"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L3" id="line1264"><code><span class="pln">            item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">'ecl-mega-menu__subitem--current'</span><span class="pun">);</span></code></li><li class="L4" id="line1265"><code><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">backItemLevel2 </span><span class="pun">=</span><span class="pln"> item</span><span class="pun">;</span></code></li><li class="L5" id="line1266"><code><span class="pln">          </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line1267"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line1268"><code><span class="pln">              item</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L8" id="line1269"><code><span class="pln">              itemLink</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L9" id="line1270"><code><span class="pln">              itemLink</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L0" id="line1271"><code><span class="pln">              item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__subitem--expanded'</span><span class="pun">);</span></code></li><li class="L1" id="line1272"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L2" id="line1273"><code><span class="pln">            item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__subitem--current'</span><span class="pun">);</span></code></li><li class="L3" id="line1274"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L4" id="line1275"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L5" id="line1276"><code></code></li><li class="L6" id="line1277"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> num</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">:</span><span class="pln"> menuItem </span><span class="pun">};</span></code></li><li class="L7" id="line1278"><code><span class="pln">        siblings </span><span class="pun">=</span><span class="pln"> menuItem</span><span class="pun">.</span><span class="pln">parentNode</span><span class="pun">.</span><span class="pln">childNodes</span><span class="pun">;</span></code></li><li class="L8" id="line1279"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1280"><code><span class="pln">          </span><span class="com">// Reset style for the siblings, in case they were hidden</span></code></li><li class="L0" id="line1281"><code><span class="pln">          siblings</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">sibling</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1282"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sibling </span><span class="pun">!==</span><span class="pln"> menuItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line1283"><code><span class="pln">              sibling</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">display </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L3" id="line1284"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L4" id="line1285"><code><span class="pln">          </span><span class="pun">});</span></code></li><li class="L5" id="line1286"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line1287"><code><span class="pln">          </span><span class="com">// Hide other items in the sublist</span></code></li><li class="L7" id="line1288"><code><span class="pln">          siblings</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">sibling</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1289"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sibling </span><span class="pun">!==</span><span class="pln"> menuItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1290"><code><span class="pln">              sibling</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">display </span><span class="pun">=</span><span class="pln"> </span><span class="str">'none'</span><span class="pun">;</span></code></li><li class="L0" id="line1291"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L1" id="line1292"><code><span class="pln">          </span><span class="pun">});</span></code></li><li class="L2" id="line1293"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3" id="line1294"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">positionMenuOverlay</span><span class="pun">();</span></code></li><li class="L4" id="line1295"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> details </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> panel</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">:</span><span class="pln"> menuItem </span><span class="pun">};</span></code></li><li class="L5" id="line1296"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">trigger</span><span class="pun">(</span><span class="str">'OnOpenPanel'</span><span class="pun">,</span><span class="pln"> details</span><span class="pun">);</span></code></li><li class="L6" id="line1297"><code><span class="pln">        </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L7" id="line1298"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L8" id="line1299"><code></code></li><li class="L9" id="line1300"><code><span class="pln">      </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'collapse'</span><span class="pun">:</span></code></li><li class="L0" id="line1301"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu--two-panels'</span><span class="pun">);</span></code></li><li class="L1" id="line1302"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> num</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">};</span></code></li><li class="L2" id="line1303"><code><span class="pln">        menuItem</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L3" id="line1304"><code><span class="pln">        </span><span class="com">// eslint-disable-next-line no-case-declarations</span></code></li><li class="L4" id="line1305"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> itemLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subLinkSelector</span><span class="pun">,</span><span class="pln"> menuItem</span><span class="pun">);</span></code></li><li class="L5" id="line1306"><code><span class="pln">        itemLink</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L6" id="line1307"><code><span class="pln">        menuItem</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span></code></li><li class="L7" id="line1308"><code><span class="pln">          </span><span class="str">'ecl-mega-menu__subitem--expanded'</span><span class="pun">,</span></code></li><li class="L8" id="line1309"><code><span class="pln">          </span><span class="str">'ecl-mega-menu__subitem--current'</span><span class="pun">,</span></code></li><li class="L9" id="line1310"><code><span class="pln">        </span><span class="pun">);</span></code></li><li class="L0" id="line1311"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">infoPanel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1312"><code><span class="pln">          infoPanel</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L2" id="line1313"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3" id="line1314"><code><span class="pln">        </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L4" id="line1315"><code></code></li><li class="L5" id="line1316"><code><span class="pln">      </span><span class="kwd">default</span><span class="pun">:</span></code></li><li class="L6" id="line1317"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7" id="line1318"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L8" id="line1319"><code></code></li><li class="L9" id="line1320"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L0" id="line1321"><code><span class="com">   * Click on a menu item</span></code></li><li class="L1" id="line1322"><code><span class="com">   *</span></code></li><li class="L2" id="line1323"><code><span class="com">   * @param {Event} e</span></code></li><li class="L3" id="line1324"><code><span class="com">   *</span></code></li><li class="L4" id="line1325"><code><span class="com">   * @fires MegaMenu#onItemClick</span></code></li><li class="L5" id="line1326"><code><span class="com">   */</span></code></li><li class="L6" id="line1327"><code><span class="pln">  handleClickOnItem</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line1328"><code><span class="pln">    let isInTheContainer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L8" id="line1329"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> menuItem </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="str">'li'</span><span class="pun">);</span></code></li><li class="L9" id="line1330"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> parentLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__parent-link'</span><span class="pun">,</span><span class="pln"> menuItem</span><span class="pun">);</span></code></li><li class="L0" id="line1331"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">parentLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1332"><code><span class="pln">      </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L2" id="line1333"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3" id="line1334"><code></code></li><li class="L4" id="line1335"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> container </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span></code></li><li class="L5" id="line1336"><code><span class="pln">      </span><span class="str">'.ecl-mega-menu__mega-container-scrollable'</span><span class="pun">,</span></code></li><li class="L6" id="line1337"><code><span class="pln">      menuItem</span><span class="pun">,</span></code></li><li class="L7" id="line1338"><code><span class="pln">    </span><span class="pun">);</span></code></li><li class="L8" id="line1339"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">container</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1340"><code><span class="pln">      isInTheContainer </span><span class="pun">=</span><span class="pln"> container</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">);</span></code></li><li class="L0" id="line1341"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1" id="line1342"><code><span class="pln">    </span><span class="com">// We need to ensure that the click doesn't come from a parent link</span></code></li><li class="L2" id="line1343"><code><span class="pln">    </span><span class="com">// or from an open container, in that case we do not act.</span></code></li><li class="L3" id="line1344"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L4" id="line1345"><code><span class="pln">      </span><span class="pun">!</span><span class="pln">e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span></code></li><li class="L5" id="line1346"><code><span class="pln">        </span><span class="str">'ecl-mega-menu__mega-container-scrollable'</span><span class="pun">,</span></code></li><li class="L6" id="line1347"><code><span class="pln">      </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&&</span></code></li><li class="L7" id="line1348"><code><span class="pln">      </span><span class="pun">!</span><span class="pln">isInTheContainer</span></code></li><li class="L8" id="line1349"><code><span class="pln">    </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1350"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">trigger</span><span class="pun">(</span><span class="str">'onItemClick'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> item</span><span class="pun">:</span><span class="pln"> menuItem</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">event</span><span class="pun">:</span><span class="pln"> e </span><span class="pun">});</span></code></li><li class="L0" id="line1351"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> hasChildren </span><span class="pun">=</span><span class="pln"> menuItem</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">);</span></code></li><li class="L1" id="line1352"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">hasChildren </span><span class="pun">&&</span><span class="pln"> menuItem</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__item'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line1353"><code><span class="pln">        e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L3" id="line1354"><code><span class="pln">        e</span><span class="pun">.</span><span class="pln">stopPropagation</span><span class="pun">();</span></code></li><li class="L4" id="line1355"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line1356"><code><span class="pln">          </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFirstPanel</span><span class="pun">(</span><span class="pln">menuItem</span><span class="pun">,</span><span class="pln"> </span><span class="str">'expand'</span><span class="pun">);</span></code></li><li class="L6" id="line1357"><code><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line1358"><code><span class="pln">          </span><span class="kwd">const</span><span class="pln"> isExpandable </span><span class="pun">=</span><span class="pln"> hasChildren </span><span class="pun">===</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">;</span></code></li><li class="L8" id="line1359"><code><span class="pln">          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isExpandable</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1360"><code><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFirstPanel</span><span class="pun">(</span><span class="pln">menuItem</span><span class="pun">,</span><span class="pln"> </span><span class="str">'collapse'</span><span class="pun">);</span></code></li><li class="L0" id="line1361"><code><span class="pln">          </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1362"><code><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">closeOpenDropdown</span><span class="pun">();</span></code></li><li class="L2" id="line1363"><code><span class="pln">            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFirstPanel</span><span class="pun">(</span><span class="pln">menuItem</span><span class="pun">,</span><span class="pln"> </span><span class="str">'expand'</span><span class="pun">);</span></code></li><li class="L3" id="line1364"><code><span class="pln">          </span><span class="pun">}</span></code></li><li class="L4" id="line1365"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L5" id="line1366"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L6" id="line1367"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7" id="line1368"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L8" id="line1369"><code></code></li><li class="L9" id="line1370"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L0" id="line1371"><code><span class="com">   * Click on a subitem</span></code></li><li class="L1" id="line1372"><code><span class="com">   *</span></code></li><li class="L2" id="line1373"><code><span class="com">   * @param {Event} e</span></code></li><li class="L3" id="line1374"><code><span class="com">   */</span></code></li><li class="L4" id="line1375"><code><span class="pln">  handleClickOnSubitem</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line1376"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> menuItem </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">closest</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItemSelector</span><span class="pun">);</span></code></li><li class="L6" id="line1377"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">menuItem </span><span class="pun">&&</span><span class="pln"> menuItem</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line1378"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> parentLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__parent-link'</span><span class="pun">,</span><span class="pln"> menuItem</span><span class="pun">);</span></code></li><li class="L8" id="line1379"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">parentLink</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1380"><code><span class="pln">        </span><span class="kwd">return</span><span class="pun">;</span></code></li><li class="L0" id="line1381"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L1" id="line1382"><code><span class="pln">      e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span></code></li><li class="L2" id="line1383"><code><span class="pln">      e</span><span class="pun">.</span><span class="pln">stopPropagation</span><span class="pun">();</span></code></li><li class="L3" id="line1384"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> isExpanded </span><span class="pun">=</span><span class="pln"> menuItem</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="str">'true'</span><span class="pun">;</span></code></li><li class="L4" id="line1385"><code></code></li><li class="L5" id="line1386"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isExpanded</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line1387"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleSecondPanel</span><span class="pun">(</span><span class="pln">menuItem</span><span class="pun">,</span><span class="pln"> </span><span class="str">'collapse'</span><span class="pun">);</span></code></li><li class="L7" id="line1388"><code><span class="pln">      </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1389"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleSecondPanel</span><span class="pun">(</span><span class="pln">menuItem</span><span class="pun">,</span><span class="pln"> </span><span class="str">'expand'</span><span class="pun">);</span></code></li><li class="L9" id="line1390"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L0" id="line1391"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1" id="line1392"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L2" id="line1393"><code></code></li><li class="L3" id="line1394"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L4" id="line1395"><code><span class="com">   * Deselect any opened menu item</span></code></li><li class="L5" id="line1396"><code><span class="com">   *</span></code></li><li class="L6" id="line1397"><code><span class="com">   * @fires MegaMenu#onFocusTrapToggle</span></code></li><li class="L7" id="line1398"><code><span class="com">   */</span></code></li><li class="L8" id="line1399"><code><span class="pln">  closeOpenDropdown</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1400"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">enableScroll</span><span class="pun">();</span></code></li><li class="L0" id="line1401"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L1" id="line1402"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">removeAttribute</span><span class="pun">(</span><span class="str">'data-expanded'</span><span class="pun">);</span></code></li><li class="L2" id="line1403"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span></code></li><li class="L3" id="line1404"><code><span class="pln">      </span><span class="str">'ecl-mega-menu--two-panels'</span><span class="pun">,</span></code></li><li class="L4" id="line1405"><code><span class="pln">      </span><span class="str">'ecl-mega-menu--one-panel'</span><span class="pun">,</span></code></li><li class="L5" id="line1406"><code><span class="pln">    </span><span class="pun">);</span></code></li><li class="L6" id="line1407"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">open</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L7" id="line1408"><code><span class="pln">    </span><span class="com">// Remove css class and attribute from inner menu</span></code></li><li class="L8" id="line1409"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">inner</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__inner--expanded'</span><span class="pun">);</span></code></li><li class="L9" id="line1410"><code></code></li><li class="L0" id="line1411"><code><span class="pln">    </span><span class="com">// Reset heights</span></code></li><li class="L1" id="line1412"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> megaMenus </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span></code></li><li class="L2" id="line1413"><code><span class="pln">      </span><span class="str">'.ecl-mega-menu__item > .ecl-mega-menu__wrapper > .ecl-container > [data-ecl-mega-menu-mega]'</span><span class="pun">,</span></code></li><li class="L3" id="line1414"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">,</span></code></li><li class="L4" id="line1415"><code><span class="pln">    </span><span class="pun">);</span></code></li><li class="L5" id="line1416"><code><span class="pln">    megaMenus</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">mega</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line1417"><code><span class="pln">      mega</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L7" id="line1418"><code><span class="pln">      mega</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">top </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L8" id="line1419"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L9" id="line1420"><code><span class="pln">    </span><span class="com">// Remove css class and attribute from menu items</span></code></li><li class="L0" id="line1421"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">items</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1422"><code><span class="pln">      item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__item--current'</span><span class="pun">);</span></code></li><li class="L2" id="line1423"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line1424"><code><span class="pln">        item</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L4" id="line1425"><code><span class="pln">        item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__item--expanded'</span><span class="pun">);</span></code></li><li class="L5" id="line1426"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> itemLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">linkSelector</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">);</span></code></li><li class="L6" id="line1427"><code><span class="pln">        itemLink</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L7" id="line1428"><code><span class="pln">        itemLink</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L8" id="line1429"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L9" id="line1430"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L0" id="line1431"><code><span class="pln">    </span><span class="com">// Remove css class and attribute from menu subitems</span></code></li><li class="L1" id="line1432"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subItems</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">item</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line1433"><code><span class="pln">      item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__subitem--current'</span><span class="pun">);</span></code></li><li class="L3" id="line1434"><code><span class="pln">      item</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">display </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L4" id="line1435"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item</span><span class="pun">.</span><span class="pln">hasAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5" id="line1436"><code><span class="pln">        item</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__subitem--expanded'</span><span class="pun">);</span></code></li><li class="L6" id="line1437"><code><span class="pln">        item</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L7" id="line1438"><code><span class="pln">        item</span><span class="pun">.</span><span class="pln">style</span><span class="pun">.</span><span class="pln">display </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L8" id="line1439"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> itemLink </span><span class="pun">=</span><span class="pln"> queryOne</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subLinkSelector</span><span class="pun">,</span><span class="pln"> item</span><span class="pun">);</span></code></li><li class="L9" id="line1440"><code><span class="pln">        itemLink</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'false'</span><span class="pun">);</span></code></li><li class="L0" id="line1441"><code><span class="pln">        itemLink</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__parent-link'</span><span class="pun">);</span></code></li><li class="L1" id="line1442"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L2" id="line1443"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L3" id="line1444"><code><span class="pln">    </span><span class="com">// Remove styles set for the sublists</span></code></li><li class="L4" id="line1445"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> sublists </span><span class="pun">=</span><span class="pln"> queryAll</span><span class="pun">(</span><span class="str">'.ecl-mega-menu__sublist'</span><span class="pun">);</span></code></li><li class="L5" id="line1446"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sublists</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line1447"><code><span class="pln">      sublists</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">sublist</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=></span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line1448"><code><span class="pln">        sublist</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'ecl-mega-menu__sublist--no-border'</span><span class="pun">);</span></code></li><li class="L8" id="line1449"><code><span class="pln">      </span><span class="pun">});</span></code></li><li class="L9" id="line1450"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0" id="line1451"><code><span class="pln">    </span><span class="com">// Update label</span></code></li><li class="L1" id="line1452"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> openLabel </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">labelOpenAttribute</span><span class="pun">);</span></code></li><li class="L2" id="line1453"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">toggleLabel </span><span class="pun">&&</span><span class="pln"> openLabel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line1454"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">toggleLabel</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> openLabel</span><span class="pun">;</span></code></li><li class="L4" id="line1455"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5" id="line1456"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">openPanel </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6" id="line1457"><code><span class="pln">      num</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span></code></li><li class="L7" id="line1458"><code><span class="pln">      item</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span></code></li><li class="L8" id="line1459"><code><span class="pln">    </span><span class="pun">};</span></code></li><li class="L9" id="line1460"><code><span class="pln">    </span><span class="com">// If the focus trap is active, deactivate it</span></code></li><li class="L0" id="line1461"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">focusTrap</span><span class="pun">.</span><span class="pln">deactivate</span><span class="pun">();</span></code></li><li class="L1" id="line1462"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">trigger</span><span class="pun">(</span><span class="str">'onFocusTrapToggle'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> active</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">});</span></code></li><li class="L2" id="line1463"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isOpen </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L3" id="line1464"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L4" id="line1465"><code></code></li><li class="L5" id="line1466"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L6" id="line1467"><code><span class="com">   * Focus out of a menu link</span></code></li><li class="L7" id="line1468"><code><span class="com">   *</span></code></li><li class="L8" id="line1469"><code><span class="com">   * @param {Event} e</span></code></li><li class="L9" id="line1470"><code><span class="com">   *</span></code></li><li class="L0" id="line1471"><code><span class="com">   * @fires MegaMenu#onFocusTrapToggle</span></code></li><li class="L1" id="line1472"><code><span class="com">   */</span></code></li><li class="L2" id="line1473"><code><span class="pln">  handleFocusOut</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3" id="line1474"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> element </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">;</span></code></li><li class="L4" id="line1475"><code><span class="pln">    </span><span class="kwd">const</span><span class="pln"> menuExpanded </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="str">'aria-expanded'</span><span class="pun">);</span></code></li><li class="L5" id="line1476"><code></code></li><li class="L6" id="line1477"><code><span class="pln">    </span><span class="com">// Specific focus action for mobile menu</span></code></li><li class="L7" id="line1478"><code><span class="pln">    </span><span class="com">// Loop through the items and go back to close button</span></code></li><li class="L8" id="line1479"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">menuExpanded </span><span class="pun">===</span><span class="pln"> </span><span class="str">'true'</span><span class="pln"> </span><span class="pun">&&</span><span class="pln"> </span><span class="pun">!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isDesktop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9" id="line1480"><code><span class="pln">      </span><span class="kwd">const</span><span class="pln"> nextItem </span><span class="pun">=</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">.</span><span class="pln">nextSibling</span><span class="pun">;</span></code></li><li class="L0" id="line1481"><code></code></li><li class="L1" id="line1482"><code><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">nextItem</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2" id="line1483"><code><span class="pln">        </span><span class="kwd">const</span><span class="pln"> nextFocusTarget </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">relatedTarget</span><span class="pun">;</span></code></li><li class="L3" id="line1484"><code><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln">nextFocusTarget</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4" id="line1485"><code><span class="pln">          </span><span class="com">// This is the last item, go back to close button</span></code></li><li class="L5" id="line1486"><code><span class="pln">          </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">focusTrap</span><span class="pun">.</span><span class="pln">activate</span><span class="pun">();</span></code></li><li class="L6" id="line1487"><code><span class="pln">          </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">trigger</span><span class="pun">(</span><span class="str">'onFocusTrapToggle'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7" id="line1488"><code><span class="pln">            active</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></code></li><li class="L8" id="line1489"><code><span class="pln">            lastFocusedEl</span><span class="pun">:</span><span class="pln"> element</span><span class="pun">.</span><span class="pln">parentElement</span><span class="pun">,</span></code></li><li class="L9" id="line1490"><code><span class="pln">          </span><span class="pun">});</span></code></li><li class="L0" id="line1491"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1" id="line1492"><code><span class="pln">      </span><span class="pun">}</span></code></li><li class="L2" id="line1493"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3" id="line1494"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L4" id="line1495"><code></code></li><li class="L5" id="line1496"><code><span class="pln">  </span><span class="com">/**</span></code></li><li class="L6" id="line1497"><code><span class="com">   * Handles global click events, triggered outside of the menu.</span></code></li><li class="L7" id="line1498"><code><span class="com">   *</span></code></li><li class="L8" id="line1499"><code><span class="com">   * @param {Event} e</span></code></li><li class="L9" id="line1500"><code><span class="com">   */</span></code></li><li class="L0" id="line1501"><code><span class="pln">  handleClickGlobal</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1" id="line1502"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L2" id="line1503"><code><span class="pln">      </span><span class="pun">!</span><span class="pln">e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span></code></li><li class="L3" id="line1504"><code><span class="pln">        </span><span class="str">'ecl-mega-menu__mega-container-scrollable'</span><span class="pun">,</span></code></li><li class="L4" id="line1505"><code><span class="pln">      </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&&</span></code></li><li class="L5" id="line1506"><code><span class="pln">      </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">classList</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'ecl-mega-menu__overlay'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span></code></li><li class="L6" id="line1507"><code><span class="pln">        </span><span class="pun">!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">element</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">target</span><span class="pun">))</span></code></li><li class="L7" id="line1508"><code><span class="pln">    </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8" id="line1509"><code><span class="pln">      </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">closeOpenDropdown</span><span class="pun">();</span></code></li><li class="L9" id="line1510"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0" id="line1511"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L1" id="line1512"><code><span class="pun">}</span></code></li><li class="L2" id="line1513"><code></code></li><li class="L3" id="line1514"><code><span class="kwd">export</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="typ">MegaMenu</span><span class="pun">;</span></code></li></ol></pre></article></section></div><br class="clear"><footer>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.3</a> on Thu Jul 04 2024 08:17:35 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.</footer><script>prettyPrint();</script><script src="scripts/polyfill.js"></script><script src="scripts/linenumber.js"></script></body></html>